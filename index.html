<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>سیستەمی بەڕێوەبردنی قەرز</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --background-color: #f5f7fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --border-radius: 16px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --box-shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --chat-primary: #0088cc;
            --chat-secondary: #e6f7ff;
        }

        /* ڕەنگە جیاوازەکان */
        .theme-blue {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --chat-primary: #0088cc;
            --chat-secondary: #e6f7ff;
        }

        .theme-green {
            --primary-color: #2ecc71;
            --secondary-color: #27ae60;
            --chat-primary: #00a884;
            --chat-secondary: #e6fff9;
        }

        .theme-purple {
            --primary-color: #9b59b6;
            --secondary-color: #8e44ad;
            --chat-primary: #9b59b6;
            --chat-secondary: #f5e6ff;
        }

        .theme-red {
            --primary-color: #e74c3c;
            --secondary-color: #c0392b;
            --chat-primary: #e74c3c;
            --chat-secondary: #ffe6e6;
        }

        .theme-dark {
            --primary-color: #34495e;
            --secondary-color: #2c3e50;
            --background-color: #1a1a1a;
            --card-color: #2d2d2d;
            --text-color: #f0f0f0;
            --light-color: #3d3d3d;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            --chat-primary: #0088cc;
            --chat-secondary: #2a2f32;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Sans Arabic', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 90px;
            font-size: 15px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* پەنجەرەی Login و Register */
        .auth-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--background-color);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }

        .auth-page.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        .auth-container {
            max-width: 400px;
            margin: 50px auto;
        }

        .auth-card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .auth-logo {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .auth-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .auth-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }

        .auth-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .form-notice {
            background-color: rgba(74, 111, 165, 0.1);
            border-right: 4px solid var(--primary-color);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: right;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .form-notice h4 {
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        /* سیستمێکی چات وەکوو تیلیگرام */
        .chat-system {
            margin-top: 20px;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 70vh;
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .chat-header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .chat-user-details h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .chat-user-details p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .chat-status.online::before {
            content: '';
            width: 8px;
            height: 8px;
            background-color: #4CAF50;
            border-radius: 50%;
            display: inline-block;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: var(--background-color);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }

        .message-sent {
            align-self: flex-end;
            background-color: var(--chat-primary);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message-received {
            align-self: flex-start;
            background-color: var(--chat-secondary);
            color: var(--text-color);
            border-bottom-left-radius: 5px;
        }

        .message-content {
            margin-bottom: 5px;
        }

        .message-time {
            font-size: 0.8rem;
            opacity: 0.7;
            text-align: left;
        }

        .message-sent .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .message-received .message-time {
            color: rgba(0, 0, 0, 0.6);
        }

        .chat-input-container {
            padding: 20px;
            background-color: var(--card-color);
            border-top: 1px solid rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 12px 18px;
            border: 1px solid #ddd;
            border-radius: 24px;
            font-size: 1rem;
            resize: none;
            min-height: 50px;
            max-height: 120px;
            background-color: var(--card-color);
            color: var(--text-color);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--chat-primary);
        }

        .chat-action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--chat-primary);
            color: white;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .chat-action-btn:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }

        .chat-action-btn.recording {
            background-color: var(--danger-color);
            animation: pulse 1.5s infinite;
        }

        .voice-message-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background-color: var(--light-color);
            border-radius: 24px;
            margin-bottom: 10px;
        }

        .voice-waveform {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 30px;
        }

        .wave-bar {
            width: 3px;
            background-color: var(--chat-primary);
            border-radius: 2px;
            animation: wave 1.5s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { height: 10px; }
            50% { height: 20px; }
        }

        .voice-duration {
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .chat-contacts {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
        }

        .contacts-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--light-color);
        }

        .contact-item:hover {
            background-color: rgba(0, 136, 204, 0.1);
            transform: translateX(-5px);
        }

        .contact-item.active {
            background-color: rgba(0, 136, 204, 0.2);
            border-right: 3px solid var(--chat-primary);
        }

        .contact-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--chat-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin-left: 15px;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .contact-role {
            font-size: 0.85rem;
            color: #666;
            background-color: rgba(0, 136, 204, 0.1);
            padding: 3px 10px;
            border-radius: 12px;
            display: inline-block;
        }

        .contact-role.admin {
            background-color: rgba(255, 193, 7, 0.2);
            color: #d48806;
        }

        .unread-badge {
            background-color: var(--danger-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* بەشی دەستکاری وردەکاری بەکارهێنەران لەلای mustafa */
        .user-details-admin {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--box-shadow);
        }

        .user-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .user-detail-item {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
        }

        .user-detail-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .user-detail-value {
            font-weight: 600;
            font-size: 1.1rem;
            word-break: break-all;
        }

        /* ئێدی خوارەوە بۆ دەستکاری مۆبایل */
        /* زۆر بچووک (تەلەفۆنە بچووکەکان) */
        @media (max-width: 360px) {
            body {
                font-size: 14px;
            }
            
            .header h1 {
                font-size: 1.4rem !important;
            }
            
            .tab {
                padding: 12px 10px !important;
                font-size: 0.85rem !important;
            }
            
            .card {
                padding: 15px !important;
            }
            
            .btn {
                padding: 10px 15px !important;
                font-size: 0.9rem !important;
            }
            
            .auth-card {
                padding: 20px !important;
            }
            
            .chat-user-avatar,
            .contact-avatar {
                width: 40px !important;
                height: 40px !important;
                font-size: 1.2rem !important;
            }
        }

        /* مۆبایلە مامناوەندەکان */
        @media (max-width: 480px) {
            .header {
                padding: 18px 15px !important;
            }
            
            .card-title {
                font-size: 1.1rem !important;
            }
            
            .form-control {
                padding: 10px 12px !important;
            }
            
            .bottom-nav {
                padding: 10px 0 !important;
            }
            
            .nav-item i {
                font-size: 1.1rem !important;
            }
            
            .auth-container {
                margin: 20px auto;
            }
            
            .chat-container {
                height: 60vh;
            }
            
            .message {
                max-width: 85% !important;
            }
        }

        /* هێدەر */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 22px 15px;
            text-align: center;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background 0.3s ease;
        }

        .header h1 {
            font-size: 1.6rem;
            margin-bottom: 5px;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* تابەکان */
        .tabs {
            display: flex;
            background-color: var(--card-color);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            overflow-x: auto;
            position: sticky;
            top: 86px;
            z-index: 99;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 16px 18px;
            white-space: nowrap;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab i {
            margin-left: 8px;
            font-size: 1.1rem;
        }

        /* پەیجەکان */
        .page {
            display: none;
            padding: 20px 15px;
            animation: fadeIn 0.4s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* کارتەکان */
        .card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 18px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.03);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-hover);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* دوگمەکان */
        .btn {
            padding: 13px 22px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            gap: 8px;
            outline: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: #333;
        }

        .btn-info {
            background-color: var(--info-color);
            color: white;
        }

        .btn-sm {
            padding: 9px 16px;
            font-size: 0.9rem;
        }

        .btn-block {
            width: 100%;
        }

        /* لیستەکان */
        .person-list, .debt-list, .quick-debt-list {
            max-height: 450px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .person-item, .debt-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: var(--transition);
            border-radius: 12px;
            margin-bottom: 6px;
        }

        .person-item:last-child, .debt-item:last-child {
            margin-bottom: 0;
        }

        .person-item:hover, .debt-item:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .person-item.active, .debt-item.active {
            background-color: rgba(74, 111, 165, 0.08);
            border-right: 4px solid var(--primary-color);
        }

        .person-info h3, .debt-info h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .person-info p, .debt-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .debt-amount {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .debt-overdue {
            color: var(--danger-color);
        }

        /* فۆرمەکان */
        .form-group {
            margin-bottom: 22px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--card-color);
            color: var(--text-color);
            text-align: right;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* وردەکاری */
        .detail-view {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            background-color: var(--card-color);
            z-index: 1000;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            -webkit-overflow-scrolling: touch;
        }

        .detail-view.active {
            transform: translateX(0);
        }

        .detail-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .detail-content {
            padding: 22px;
        }

        .close-detail {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-detail:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        /* بۆتۆم نێڤ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-color);
            display: flex;
            justify-content: space-around;
            padding: 14px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08);
            z-index: 100;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #666;
            text-decoration: none;
            font-size: 0.8rem;
            transition: var(--transition);
            flex: 1;
            padding: 5px 0;
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-item i {
            font-size: 1.3rem;
            margin-bottom: 4px;
        }

        /* ڕاپۆرت */
        .report-card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 18px;
            box-shadow: var(--box-shadow);
        }

        .month-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 22px;
        }

        .month-nav {
            background-color: rgba(0, 0, 0, 0.05);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            transition: var(--transition);
        }

        .month-nav:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .month-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 22px;
        }

        .stat-item {
            background-color: var(--light-color);
            padding: 18px;
            border-radius: var(--border-radius);
            text-align: center;
            transition: var(--transition);
        }

        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* باری خالی */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 18px;
            opacity: 0.4;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #666;
        }

        /* ڕێکخستنەکان */
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .setting-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-color);
        }

        .setting-desc {
            font-size: 0.85rem;
            color: #777;
            max-width: 80%;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* تێمەکان (ڕەنگەکان) */
        .theme-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .theme-option {
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            font-weight: 500;
        }

        .theme-option.active {
            border-color: var(--primary-color);
            transform: scale(1.02);
        }

        .theme-option.blue {
            background-color: #4a6fa5;
            color: white;
        }

        .theme-option.green {
            background-color: #2ecc71;
            color: white;
        }

        .theme-option.purple {
            background-color: #9b59b6;
            color: white;
        }

        .theme-option.red {
            background-color: #e74c3c;
            color: white;
        }

        .theme-option.dark {
            background-color: #34495e;
            color: white;
        }

        /* بەدیلەکان */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background-color: rgba(74, 111, 165, 0.1);
            color: var(--primary-color);
        }

        .badge-danger {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .badge-success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        /* وەرگرتنی تایبەتمەندییەکانی سیستەم */
        .system-info {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .info-label {
            color: #666;
        }

        .info-value {
            font-weight: 500;
            color: var(--text-color);
        }

        /* لۆدینگ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(74, 111, 165, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* نۆتیفیکەیشن */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* هێڵی پێشکەوتن */
        .progress-bar {
            height: 6px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* پارەدان */
        .payment-form {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
        }

        .remaining-amount {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 15px;
        }

        /* جیاوازی بەرەنگاری بچووکترین ئەکرینەکان */
        @media (max-width: 320px) {
            .header {
                padding: 15px 12px !important;
            }
            
            .header h1 {
                font-size: 1.3rem !important;
            }
            
            .tabs {
                top: 76px;
            }
            
            .tab {
                padding: 12px 8px !important;
                font-size: 0.8rem !important;
            }
            
            .page {
                padding: 15px 12px !important;
            }
            
            .card {
                padding: 12px !important;
                margin-bottom: 12px !important;
            }
            
            .btn {
                padding: 10px 12px !important;
                font-size: 0.85rem !important;
            }
            
            .bottom-nav {
                padding: 8px 0 !important;
            }
            
            .nav-item i {
                font-size: 1rem !important;
            }
            
            .nav-item span {
                font-size: 0.7rem !important;
            }
            
            .form-row {
                flex-direction: column;
                gap: 12px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .theme-options {
                grid-template-columns: 1fr;
            }
            
            .auth-card {
                padding: 15px !important;
            }
            
            .chat-container {
                height: 50vh;
            }
        }

        /* پشتگیری هەموو فڕەیمەکان */
        @supports (padding: max(0px)) {
            .page {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
            }
            
            .bottom-nav {
                padding-bottom: max(14px, env(safe-area-inset-bottom));
            }
            
            .auth-page {
                padding-left: max(20px, env(safe-area-inset-left));
                padding-right: max(20px, env(safe-area-inset-right));
            }
        }
        
        /* ستایلی تایبەت بۆ لیستی پارەدانەکان */
        .payment-history {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-top: 20px;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .payment-history-item {
            padding: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .payment-history-item:last-child {
            border-bottom: none;
        }
        
        /* نۆتیفیکەیشن بەرگی سەرەوە */
        .notification-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background-color: var(--danger-color);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        /* خۆتۆماربوون */
        .logout-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
            z-index: 101;
        }
        
        .logout-btn:hover {
            background-color: rgba(255,255,255,0.3);
        }
        
        /* بەشی دەستکاری بەکارهێنەران */
        .admin-controls {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--box-shadow);
        }
        
        .user-list {
            margin-top: 20px;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .user-item:hover {
            background-color: rgba(0,0,0,0.02);
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .user-item-info h4 {
            margin-bottom: 5px;
        }
        
        .user-item-info p {
            font-size: 0.9rem;
            color: #666;
        }
        
        .user-role {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .user-role.admin {
            background-color: rgba(255, 193, 7, 0.2);
            color: #d48806;
        }
        
        .user-role.user {
            background-color: rgba(74, 111, 165, 0.2);
            color: var(--primary-color);
        }
        
        /* Auto-date indicator */
        .auto-date-indicator {
            background-color: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.3);
            padding: 8px 15px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            color: var(--success-color);
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
    </style>
</head>
<body class="theme-blue">
    <!-- پەنجەرەی Login و Register -->
    <div class="auth-page" id="auth-page">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-logo">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <h1 class="auth-title">سیستەمی بەڕێوەبردنی قەرز</h1>
                <p class="auth-subtitle">تکایە خۆتۆمار بکە یان چوونەژوورەوە بکە</p>
                
                <div class="auth-tabs">
                    <div class="auth-tab active" data-form="login">چوونەژوورەوە</div>
                    <div class="auth-tab" data-form="register">خۆتۆمارکردن</div>
                </div>
                
                <!-- فۆرمی Login -->
                <form id="login-form" class="auth-form active">
                    <div class="form-group">
                        <label for="login-username">ناوی بەکارهێنەر</label>
                        <input type="text" id="login-username" class="form-control" required placeholder="ناوی بەکارهێنەر بنووسە" value="mustafa">
                    </div>
                    <div class="form-group">
                        <label for="login-password">وشەی نهێنی</label>
                        <input type="password" id="login-password" class="form-control" required placeholder="وشەی نهێنی بنووسە" value="Tdkr2713">
                    </div>
                    <div class="form-group">
                        <label class="switch">
                            <input type="checkbox" id="remember-me" checked>
                            <span class="slider"></span>
                            <span style="margin-right: 10px; font-size: 0.9rem;">لەبیرم مەکە</span>
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-sign-in-alt"></i>
                        چوونەژوورەوە
                    </button>
                    
                    <div class="form-notice">
                        <h4>ئەکاونتەکانی ئەدمین:</h4>
                        <p><strong>mustafa</strong> - Tdkr2713</p>
                        <p><strong>muhamad</strong> - Tdkr2814</p>
                        <p style="margin-top: 10px; color: var(--danger-color);">تەنها ئەم دوو ئەکاونتە دەتوانن دەستکاری بکەن</p>
                    </div>
                </form>
                
                <!-- فۆرمی Register -->
                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="register-name">ناوی تەواو</label>
                        <input type="text" id="register-name" class="form-control" required placeholder="ناوی تەواو بنووسە">
                    </div>
                    <div class="form-group">
                        <label for="register-username">ناوی بەکارهێنەر</label>
                        <input type="text" id="register-username" class="form-control" required placeholder="ناوی بەکارهێنەر دروست بکە">
                    </div>
                    <div class="form-group">
                        <label for="register-password">وشەی نهێنی</label>
                        <input type="password" id="register-password" class="form-control" required placeholder="وشەی نهێنی دروست بکە">
                    </div>
                    <div class="form-group">
                        <label for="register-phone">ژمارەی مۆبایل</label>
                        <input type="tel" id="register-phone" class="form-control" required placeholder="ژمارەی مۆبایل بنووسە">
                    </div>
                    <button type="submit" class="btn btn-success btn-block">
                        <i class="fas fa-user-plus"></i>
                        خۆتۆمارکردن
                    </button>
                    
                    <div class="form-notice">
                        <h4>ئاگاداری:</h4>
                        <p>ئەوانەی کە خۆیان تۆمار دەکەن تەنها دەتوانن داتاکان ببینن و نەتوانن دەستکاری بکەن.</p>
                        <p>بۆ دەستکاری کردن پێویستە یەکێک لە دوو ئەکاونتەکانی ئەدمین بەکاربهێنن.</p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- پەنجەرەی سەرەکی -->
    <div id="main-app" style="display: none;">
        <!-- نۆتیفیکەیشن -->
        <div class="notification" id="notification">
            کردارەکە بە سەرکەوتوویی جێبەجێ کرا!
        </div>

        <!-- هێدەر -->
        <div class="header">
            <button class="logout-btn" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                چوونەدەرەوە
            </button>
            <div id="user-badge"></div>
            <h1>سیستەمی بەڕێوەبردنی قەرز</h1>
            <p>بەڕێوەبردنی ئاسان و خێرای قەرزەکان</p>
        </div>

        <!-- تابەکان -->
        <div class="tabs">
            <div class="tab active" data-page="home">
                <i class="fas fa-home"></i>
                سەرەکی
            </div>
            <div class="tab" data-page="quick-debt">
                <i class="fas fa-bolt"></i>
                قەرزی خێرا
            </div>
            <div class="tab" data-page="chat">
                <i class="fas fa-comments"></i>
                چات
                <span id="notification-counter" class="notification-badge" style="display: none;">0</span>
            </div>
            <div class="tab" data-page="report">
                <i class="fas fa-chart-bar"></i>
                ڕاپۆرت
            </div>
            <div class="tab" data-page="settings">
                <i class="fas fa-cog"></i>
                ڕێکخستنەکان
            </div>
        </div>

        <!-- پەیجی ماڵەوە -->
        <div id="home" class="page active">
            <!-- لیستی کەسەکان -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-users"></i>
                        لیستی کەسەکان
                    </div>
                    <button class="btn btn-primary btn-sm" id="add-person">
                        <i class="fas fa-plus"></i>
                        زیادکردنی کەس
                    </button>
                </div>
                <div class="person-list" id="person-list">
                    <!-- لیستی کەسەکان لێرە دێت -->
                </div>
            </div>
            
            <!-- بەشی تایبەت بۆ mustafa بۆ بینینی وردەکاری بەکارهێنەران -->
            <div id="admin-user-details" style="display: none;">
                <!-- وردەکاری بەکارهێنەران لێرە دێت -->
            </div>
        </div>

        <!-- پەیجی قەرزی خێرا -->
        <div id="quick-debt" class="page">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-bolt"></i>
                        قەرزی خێرا
                    </div>
                    <div class="badge">بۆ کەسانی نوێ</div>
                </div>
                <div class="card-body">
                    <form id="quick-debt-form">
                        <div class="form-group">
                            <label for="quick-name">ناوی کەس</label>
                            <input type="text" id="quick-name" class="form-control" required placeholder="ناوی تەواو بنووسە">
                        </div>
                        <div class="form-group">
                            <label for="quick-phone">ژمارەی مۆبایل</label>
                            <input type="tel" id="quick-phone" class="form-control" required placeholder="ژمارەی مۆبایل بنووسە">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="quick-amount">بڕی پارە</label>
                                <input type="number" id="quick-amount" class="form-control" min="1" required placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="quick-date">بەروار</label>
                                <input type="date" id="quick-date" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="quick-notes">تێبینی (ئارەزوومەندانە)</label>
                            <textarea id="quick-notes" class="form-control" rows="2" placeholder="تێبینیێک بۆ ئەم قەرزە زیاد بکە"></textarea>
                        </div>
                        <div class="auto-date-indicator" id="auto-date-indicator">
                            <i class="fas fa-calendar-check"></i>
                            بەروار بە شێوەی خۆکار زیاد دەکرێت
                        </div>
                        <button type="submit" class="btn btn-success btn-block">
                            <i class="fas fa-save"></i>
                            پاشەکەوتی قەرز
                        </button>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-list"></i>
                        لیستی قەرزی خێرا
                    </div>
                    <button class="btn btn-info btn-sm" id="refresh-quick-list">
                        <i class="fas fa-sync-alt"></i>
                        نوێکردنەوە
                    </button>
                </div>
                <div class="quick-debt-list" id="quick-debt-list">
                    <!-- لیستی قەرزی خێرا لێرە دێت -->
                </div>
            </div>
        </div>

        <!-- پەیجی چات -->
        <div id="chat" class="page">
            <!-- لیستی کۆنتاکتەکان -->
            <div class="chat-contacts">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-user-friends"></i>
                        کۆنتاکتەکان
                    </div>
                </div>
                <div class="contacts-list" id="contacts-list">
                    <!-- لیستی کۆنتاکتەکان لێرە دێت -->
                </div>
            </div>
            
            <!-- سیستمێکی چات -->
            <div class="chat-system" id="chat-system" style="display: none;">
                <div class="chat-container" id="chat-container">
                    <!-- چات لێرە دێت -->
                </div>
            </div>
            
            <!-- نیشاندانی ئەگەر هیچ کۆنتاکتێک دیاری نەکرابێت -->
            <div id="no-chat-selected" class="empty-state">
                <i class="fas fa-comments"></i>
                <h3>چات</h3>
                <p>کۆنتاکتێک هەڵبژێرە بۆ دەستپێکردنی گفتوگۆ</p>
            </div>
        </div>

        <!-- پەیجی ڕاپۆرت -->
        <div id="report" class="page">
            <div class="month-selector">
                <button class="month-nav" id="prev-month">
                    <i class="fas fa-chevron-right"></i>
                </button>
                <div class="month-title" id="report-month">مانگی 5 - 2023</div>
                <button class="month-nav" id="next-month">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="total-debts">0 دینار</div>
                    <div class="stat-label">کۆی گشتی قەرزەکان</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-people">0</div>
                    <div class="stat-label">ژمارەی کەسەکان</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="paid-debts">0 دینار</div>
                    <div class="stat-label">قەرزە وەدەگیراوەکان</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="unpaid-debts">0 دینار</div>
                    <div class="stat-label">قەرزە وەنانەدراوەکان</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-pie"></i>
                        دابەشبوونی قەرزەکان
                    </div>
                </div>
                <div id="debt-distribution">
                    <!-- دابەشبوونی قەرزەکان لێرە دێت -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-calendar-alt"></i>
                        پێشکەوتنی مانگانە
                    </div>
                </div>
                <div class="card-body">
                    <div class="info-item">
                        <div class="info-label">ڕێژەی وەرگرتن</div>
                        <div class="info-value" id="collection-rate">0%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="collection-progress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- پەیجی ڕێکخستنەکان -->
        <div id="settings" class="page">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-palette"></i>
                        تێم و ڕووکار
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>تێمەکە هەڵبژێرە</label>
                        <div class="theme-options">
                            <div class="theme-option blue active" data-theme="blue">شین</div>
                            <div class="theme-option green" data-theme="green">سەوز</div>
                            <div class="theme-option purple" data-theme="purple">مۆر</div>
                            <div class="theme-option red" data-theme="red">سور</div>
                            <div class="theme-option dark" data-theme="dark">تاریک</div>
                        </div>
                    </div>
                    
                    <div class="settings-item">
                        <div>
                            <div class="setting-title">دۆخی تاریک</div>
                            <div class="setting-desc">گواستنەوە لە نێوان دۆخی ڕووناک و تاریک</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="dark-mode">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="settings-item">
                        <div>
                            <div class="setting-title">فۆنتە گەورەکان</div>
                            <div class="setting-desc">زیادکردنی قەبارەی فۆنت بۆ خوێندنەوەی باشتر</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="large-fonts">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-sliders-h"></i>
                        ڕێکخستنە گشتیەکان
                    </div>
                </div>
                <div class="card-body">
                    <div class="settings-item">
                        <div>
                            <div class="setting-title">بەرواری خۆکار</div>
                            <div class="setting-desc">بەروار و کات بەشێوەی خۆکار زیاد دەبێت</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="auto-date" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <div>
                            <div class="setting-title">ئاگاداریەکانی مانگانە</div>
                            <div class="setting-desc">ئاگاداری بۆ قەرزە وەنانەدراوەکان</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="monthly-alert" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <div>
                            <div class="setting-title">قەرزە کۆنەکانی خۆکار</div>
                            <div class="setting-desc">قەرزە کۆنەکان بەشێوەی خۆکار دەگوازرێنەوە</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="auto-old-debts" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <div>
                            <div class="setting-title">فیدباکی لەرزین</div>
                            <div class="setting-desc">لەرزین لە کردارەکاندا</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="vibration" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <div>
                            <div class="setting-title">ئاگاداریە دەنگیەکان</div>
                            <div class="setting-desc">دەنگ لە کاتی ئاگاداریەکاندا</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="sound-notifications">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-database"></i>
                        بەڕێوەبردنی زانیارییەکان
                    </div>
                </div>
                <div class="card-body">
                    <button class="btn btn-primary btn-block" style="margin-bottom: 12px;" id="export-data">
                        <i class="fas fa-download"></i>
                        هەناردەی زانیارییەکان
                    </button>
                    <button class="btn btn-warning btn-block" style="margin-bottom: 12px;" id="import-data">
                        <i class="fas fa-upload"></i>
                        هێنانی زانیارییەکان
                    </button>
                    <button class="btn btn-info btn-block" style="margin-bottom: 12px;" id="backup-data">
                        <i class="fas fa-copy"></i>
                        دروستکردنی پاشەکەوت
                    </button>
                    <button class="btn btn-danger btn-block" id="reset-data">
                        <i class="fas fa-trash"></i>
                        سڕینەوەی هەموو زانیارییەکان
                    </button>
                </div>
            </div>
            
            <div class="card system-info">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-info-circle"></i>
                        زانیاری سیستەم
                    </div>
                </div>
                <div class="card-body">
                    <div class="info-item">
                        <div class="info-label">وەشانی ئەپ</div>
                        <div class="info-value">2.0.0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">کۆی گشتی کەسەکان</div>
                        <div class="info-value" id="sys-total-people">0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">کۆی گشتی قەرزەکان</div>
                        <div class="info-value" id="sys-total-debts">0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">قەبارەی زانیارییەکان</div>
                        <div class="info-value" id="sys-data-size">0 KB</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">دوایین پاشەکەوت</div>
                        <div class="info-value" id="sys-last-backup">هەرگیز</div>
                    </div>
                </div>
            </div>
            
            <!-- بەشی تایبەت بۆ mustafa بۆ دەستکاری بەکارهێنەران -->
            <div id="admin-user-management" style="display: none;">
                <div class="card admin-controls">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-user-shield"></i>
                            بەڕێوەبردنی بەکارهێنەران
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="user-list" id="user-management-list">
                            <!-- لیستی بەکارهێنەران لێرە دێت -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- پڕۆفایلی کەس -->
        <div class="detail-view" id="person-profile-view">
            <div class="detail-header">
                <div>
                    <h3 id="person-profile-title">پڕۆفایلی کەس</h3>
                    <p id="person-profile-subtitle"></p>
                </div>
                <button class="close-detail" id="close-person-profile">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="detail-content">
                <div id="person-profile-content">
                    <!-- وردەکاری پڕۆفایل لێرە دێت -->
                </div>
                <div class="action-buttons" style="margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-warning" id="edit-person-profile" style="flex: 1; min-width: 120px;">
                        <i class="fas fa-edit"></i>
                        دەستکاری
                    </button>
                    <button class="btn btn-danger" id="delete-person-profile" style="flex: 1; min-width: 120px;">
                        <i class="fas fa-trash"></i>
                        سڕینەوە
                    </button>
                    <button class="btn btn-primary" id="add-debt-to-person" style="flex: 1; min-width: 120px;">
                        <i class="fas fa-plus"></i>
                        قەرزی نوێ
                    </button>
                    <button class="btn btn-success" id="settle-person" style="flex: 1; min-width: 120px;">
                        <i class="fas fa-hand-holding-usd"></i>
                        واسڵکردن
                    </button>
                </div>
            </div>
        </div>

        <!-- زیادکردنی کەس -->
        <div class="detail-view" id="add-person-view">
            <div class="detail-header">
                <div>
                    <h3>زیادکردنی کەس</h3>
                    <p>کەسێکی نوێ زیاد بکە بۆ سیستەمەکە</p>
                </div>
                <button class="close-detail" id="close-add-person">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="detail-content">
                <form id="add-person-form">
                    <div class="form-group">
                        <label for="person-name">ناوی تەواو</label>
                        <input type="text" id="person-name" class="form-control" required placeholder="ناوی تەواو بنووسە">
                    </div>
                    <div class="form-group">
                        <label for="person-phone">ژمارەی مۆبایل</label>
                        <input type="tel" id="person-phone" class="form-control" required placeholder="ژمارەی مۆبایل بنووسە">
                    </div>
                    <div class="form-group">
                        <label for="person-notes">تێبینی (ئارەزوومەندانە)</label>
                        <textarea id="person-notes" class="form-control" rows="3" placeholder="تێبینیێک بۆ ئەم کەسە زیاد بکە"></textarea>
                    </div>
                    <button type="submit" class="btn btn-success btn-block">
                        <i class="fas fa-save"></i>
                        زیادکردنی کەس
                    </button>
                </form>
            </div>
        </div>

        <!-- زیادکردنی قەرز -->
        <div class="detail-view" id="add-debt-view">
            <div class="detail-header">
                <div>
                    <h3 id="add-debt-title">زیادکردنی قەرز</h3>
                    <p id="add-debt-subtitle"></p>
                </div>
                <button class="close-detail" id="close-add-debt">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="detail-content">
                <form id="add-debt-form">
                    <div class="form-group">
                        <label for="debt-person">کەس</label>
                        <select id="debt-person" class="form-control" required>
                            <!-- کەسەکان لێرە دێت -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="debt-amount">بڕی پارە (دینار)</label>
                        <input type="number" id="debt-amount" class="form-control" min="1" required placeholder="بڕی پارە بنووسە">
                    </div>
                    <div class="form-group">
                        <label for="debt-date">بەروار</label>
                        <input type="date" id="debt-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="debt-notes">تێبینی (ئارەزوومەندانە)</label>
                        <textarea id="debt-notes" class="form-control" rows="3" placeholder="تێبینیێک بۆ ئەم قەرزە زیاد بکە"></textarea>
                    </div>
                    <div class="auto-date-indicator" id="auto-date-indicator-debt">
                        <i class="fas fa-calendar-check"></i>
                        بەروار بە شێوەی خۆکار زیاد دەکرێت
                    </div>
                    <button type="submit" class="btn btn-success btn-block">
                        <i class="fas fa-save"></i>
                        زیادکردنی قەرز
                    </button>
                </form>
            </div>
        </div>

        <!-- پارەدانی گشتی (واسڵکردن) -->
        <div class="detail-view" id="general-payment-view">
            <div class="detail-header">
                <div>
                    <h3 id="general-payment-title">واسڵکردنی قەرز</h3>
                    <p id="general-payment-subtitle"></p>
                </div>
                <button class="close-detail" id="close-general-payment">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="detail-content">
                <div id="general-payment-content">
                    <!-- زانیاری پارەدانی گشتی لێرە دێت -->
                </div>
                <form id="general-payment-form">
                    <div class="form-group">
                        <label for="general-payment-amount">بڕی پارەی دراو (دینار)</label>
                        <input type="number" id="general-payment-amount" class="form-control" min="1" required placeholder="بڕی پارە بنووسە">
                    </div>
                    <div class="form-group">
                        <label for="general-payment-date">بەرواری پارەدان</label>
                        <input type="date" id="general-payment-date" class="form-control" required>
                    </div>
                    <div class="auto-date-indicator" id="auto-date-indicator-payment">
                        <i class="fas fa-calendar-check"></i>
                        بەروار بە شێوەی خۆکار زیاد دەکرێت
                    </div>
                    <div class="form-group">
                        <label for="general-payment-notes">تێبینی (ئارەزوومەندانە)</label>
                        <textarea id="general-payment-notes" class="form-control" rows="3" placeholder="تێبینیێک بۆ ئەم پارەدانە زیاد بکە"></textarea>
                    </div>
                    <button type="submit" class="btn btn-success btn-block">
                        <i class="fas fa-check"></i>
                        تەواوکردنی واسڵکردن
                    </button>
                </form>
            </div>
        </div>

        <!-- وردەکاری قەرز -->
        <div class="detail-view" id="debt-detail-view">
            <div class="detail-header">
                <div>
                    <h3 id="debt-detail-title">وردەکاری قەرز</h3>
                    <p id="debt-detail-subtitle"></p>
                </div>
                <button class="close-detail" id="close-debt-detail">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="detail-content">
                <div id="debt-detail-content">
                    <!-- وردەکاری قەرز لێرە دێت -->
                </div>
                <div class="action-buttons" style="margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-warning" id="edit-debt" style="flex: 1; min-width: 100px;">
                        <i class="fas fa-edit"></i>
                        دەستکاری
                    </button>
                    <button class="btn btn-danger" id="delete-debt" style="flex: 1; min-width: 100px;">
                        <i class="fas fa-trash"></i>
                        سڕینەوە
                    </button>
                    <button class="btn btn-success" id="add-specific-payment" style="flex: 1; min-width: 100px;">
                        <i class="fas fa-money-bill-wave"></i>
                        پارەدان
                    </button>
                </div>
            </div>
        </div>

        <!-- بۆتۆم نێڤ -->
        <div class="bottom-nav">
            <a href="#" class="nav-item active" data-page="home">
                <i class="fas fa-home"></i>
                سەرەکی
            </a>
            <a href="#" class="nav-item" data-page="quick-debt">
                <i class="fas fa-bolt"></i>
                خێرا
            </a>
            <a href="#" class="nav-item" data-page="chat">
                <i class="fas fa-comments"></i>
                چات
                <span id="nav-notification-counter" class="notification-badge" style="display: none;">0</span>
            </a>
            <a href="#" class="nav-item" data-page="report">
                <i class="fas fa-chart-bar"></i>
                ڕاپۆرت
            </a>
            <a href="#" class="nav-item" data-page="settings">
                <i class="fas fa-cog"></i>
                ڕێکخستن
            </a>
        </div>
    </div>

    <script>
        // زانیاریەکان
        let people = [];
        let debts = [];
        let payments = [];
        let messages = [];
        let users = [];
        let currentUser = null;
        let currentPersonId = null;
        let currentDebtId = null;
        let currentMonth = new Date().getMonth() + 1;
        let currentYear = new Date().getFullYear();
        let settings = {
            autoDate: true,
            monthlyAlert: true,
            autoOldDebts: true,
            vibration: true,
            soundNotifications: false,
            theme: 'blue',
            darkMode: false,
            largeFonts: false
        };
        
        // تۆمارەکانی چات
        let currentChatContact = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let recordingTimer = null;
        let recordingSeconds = 0;

        // دەستپێکردنی ئەپ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('سیستەم دەستپێدەکات...');
            initApp();
            checkLoginStatus();
            setupAuthTabs();
            setupAuthForms();
            setupAutoDateSystem();
        });

        // دەستپێکردنی ئەپ
        function initApp() {
            console.log('دەستپێکردنی سیستم...');
            
            // دانانی بەرواری ئەمڕۆ بە شێوەی خۆکار
            const today = new Date().toISOString().split('T')[0];
            setAutoDateFields(today);
            
            // چێککردن بۆ قەرزە کۆنەکان
            checkForOverdueDebts();
        }

        // بارکردنی زانیاریەکان
        function loadUserData() {
            console.log('بارکردنی زانیارییەکان...');
            
            const savedPeople = localStorage.getItem('debtPeople');
            const savedDebts = localStorage.getItem('debtDebts');
            const savedPayments = localStorage.getItem('debtPayments');
            const savedMessages = localStorage.getItem('debtMessages');
            const savedUsers = localStorage.getItem('debtUsers');
            const savedSettings = localStorage.getItem('debtSettings');
            const savedCurrentUser = localStorage.getItem('debtCurrentUser');
            
            try {
                if (savedPeople) {
                    people = JSON.parse(savedPeople);
                    console.log('کەسەکان بارکران:', people.length);
                }
                
                if (savedDebts) {
                    debts = JSON.parse(savedDebts);
                    console.log('قەرزەکان بارکران:', debts.length);
                }
                
                if (savedPayments) {
                    payments = JSON.parse(savedPayments);
                    console.log('پارەدانەکان بارکران:', payments.length);
                }
                
                if (savedMessages) {
                    messages = JSON.parse(savedMessages);
                    console.log('پەیامەکان بارکران:', messages.length);
                } else {
                    // دروستکردنی داتای نموونەیی بۆ پەیامەکان
                    createSampleMessages();
                }
                
                if (savedUsers) {
                    users = JSON.parse(savedUsers);
                    console.log('بەکارهێنەران بارکران:', users.length);
                } else {
                    // دروستکردنی بەکارهێنەرە ئەدمینەکان
                    createAdminUsers();
                }
                
                if (savedSettings) {
                    settings = JSON.parse(savedSettings);
                    console.log('ڕێکخستنەکان بارکران:', settings);
                    applySettings();
                }
                
                if (savedCurrentUser) {
                    currentUser = JSON.parse(savedCurrentUser);
                    console.log('بەکارهێنەری ئێستا:', currentUser);
                }
                
                // چێککردن بۆ "لەبیرم مەکە"
                checkRememberedUser();
                
                // ئەگەر هیچ زانیارییەک بوونی نەبوو، داتای نموونەیی دروست بکە
                if (people.length === 0 && debts.length === 0 && payments.length === 0) {
                    createSampleData();
                }
                
            } catch (e) {
                console.error('هەڵە لە بارکردنی زانیارییەکان:', e);
                showNotification('هەڵە لە بارکردنی زانیارییەکان! پاککردنەوە...', 'error');
                resetData();
            }
        }

        // پاشەکەوتکردنی زانیاریەکان
        function saveUserData() {
            try {
                localStorage.setItem('debtPeople', JSON.stringify(people));
                localStorage.setItem('debtDebts', JSON.stringify(debts));
                localStorage.setItem('debtPayments', JSON.stringify(payments));
                localStorage.setItem('debtMessages', JSON.stringify(messages));
                localStorage.setItem('debtUsers', JSON.stringify(users));
                localStorage.setItem('debtSettings', JSON.stringify(settings));
                localStorage.setItem('debtCurrentUser', JSON.stringify(currentUser));
                console.log('زانیارییەکان پاشەکەوتکران');
                updateSystemInfo();
            } catch (e) {
                console.error('هەڵە لە پاشەکەوتکردنی زانیارییەکان:', e);
                showNotification('هەڵە لە پاشەکەوتکردنی زانیارییەکان!', 'error');
            }
        }

        // چێککردنی دۆخی Login
        function checkLoginStatus() {
            console.log('چێککردنی دۆخی چوونەژوورەوە...');
            loadUserData();
            
            if (currentUser) {
                // بەکارهێنەر لەگەڵە، پەنجەرەی سەرەکی پیشان بدە
                console.log('بەکارهێنەر لەگەڵە:', currentUser.username);
                showMainApp();
            } else {
                // بەکارهێنەر لەگەڵ نیە، پەنجەرەی Login پیشان بدە
                console.log('بەکارهێنەر لەگەڵ نیە، پەنجەرەی Login نیشان دەدرێت');
                showAuthPage();
            }
        }

        // چێککردن بۆ "لەبیرم مەکە"
        function checkRememberedUser() {
            if (!currentUser) {
                const rememberedUser = localStorage.getItem('rememberedUser');
                if (rememberedUser) {
                    try {
                        const userData = JSON.parse(rememberedUser);
                        console.log('بەکارهێنەری لەبیرکراو:', userData.username);
                        const user = users.find(u => u.username === userData.username && u.password === userData.password);
                        if (user) {
                            currentUser = user;
                            saveUserData();
                            showMainApp();
                            return true;
                        }
                    } catch (e) {
                        console.log('هەڵە لە خوێندنەوەی زانیارییەکانی بەکارهێنەر');
                    }
                }
            }
            return false;
        }

        // نیشاندانی پەنجەرەی Login
        function showAuthPage() {
            console.log('نیشاندانی پەنجەرەی چوونەژوورەوە');
            document.getElementById('auth-page').classList.add('active');
            document.getElementById('main-app').style.display = 'none';
        }

        // نیشاندانی پەنجەرەی سەرەکی
        function showMainApp() {
            console.log('نیشاندانی پەنجەرەی سەرەکی بۆ:', currentUser.username);
            document.getElementById('auth-page').classList.remove('active');
            document.getElementById('main-app').style.display = 'block';
            
            // دیاریکردنی ئاستی دەستەواژە بۆ بەکارهێنەر
            updateUserBadge();
            
            // بارکردنی زانیاریەکان
            loadPeopleList();
            loadQuickDebtList();
            loadReport();
            loadContacts();
            updateNotificationCount();
            setupTabs();
            setupForms();
            setupDetailViews();
            setupReport();
            setupBottomNav();
            loadSettings();
            updateSystemInfo();
            
            // دیاریکردنی ئاستی دەستەواژە بۆ دوگمەکان
            updateButtonPermissions();
            
            // چێککردن بۆ mustafa بۆ بینینی وردەکاری بەکارهێنەران
            if (currentUser && (currentUser.username === 'mustafa' || currentUser.username === 'muhamad')) {
                loadUserManagement();
                document.getElementById('admin-user-details').style.display = 'block';
                document.getElementById('admin-user-management').style.display = 'block';
            } else {
                document.getElementById('admin-user-details').style.display = 'none';
                document.getElementById('admin-user-management').style.display = 'none';
            }
            
            showNotification('بەخێربێیت ' + currentUser.name + '!');
        }

        // ڕێکخستنی تابەکانی Login/Register
        function setupAuthTabs() {
            const authTabs = document.querySelectorAll('.auth-tab');
            const authForms = document.querySelectorAll('.auth-form');
            
            authTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const formId = this.dataset.form;
                    
                    authTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    authForms.forEach(form => {
                        form.classList.remove('active');
                        if (form.id === formId + '-form') {
                            form.classList.add('active');
                        }
                    });
                });
            });
        }

        // ڕێکخستنی فۆرمەکانی Login/Register
        function setupAuthForms() {
            // فۆرمی Login
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;
                const rememberMe = document.getElementById('remember-me').checked;
                
                console.log('چوونەژوورەوە بە:', { username, password });
                
                // چێککردنی ناو و پاسوۆرد
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    console.log('بەکارهێنەر دۆزرایەوە:', user);
                    currentUser = user;
                    
                    if (rememberMe) {
                        localStorage.setItem('rememberedUser', JSON.stringify({username: username, password: password}));
                    } else {
                        localStorage.removeItem('rememberedUser');
                    }
                    
                    saveUserData();
                    showMainApp();
                    showNotification('بە سەرکەوتوویی چووتە ژوورەوە!');
                    
                    if (settings.vibration && 'vibrate' in navigator) {
                        navigator.vibrate(50);
                    }
                } else {
                    console.log('بەکارهێنەر نەدۆزرایەوە یان پاسوۆرد هەڵەیە');
                    showNotification('ناوی بەکارهێنەر یان وشەی نهێنی هەڵەیە!', 'error');
                    // دانانی سەرنج لەسەر خانەی پاسوۆرد
                    document.getElementById('login-password').focus();
                    document.getElementById('login-password').select();
                    
                    // ڤایبرەیشن بۆ هەڵە
                    if (settings.vibration && 'vibrate' in navigator) {
                        navigator.vibrate([100, 50, 100]);
                    }
                }
            });
            
            // فۆرمی Register
            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('register-name').value.trim();
                const username = document.getElementById('register-username').value.trim();
                const password = document.getElementById('register-password').value;
                const phone = document.getElementById('register-phone').value.trim();
                
                // چێککردن کە ناوی بەکارهێنەر پێشتر بوونی هەیە
                const existingUser = users.find(u => u.username === username);
                
                if (existingUser) {
                    showNotification('ناوی بەکارهێنەر پێشتر تۆمار کراوە!', 'error');
                    document.getElementById('register-username').focus();
                    document.getElementById('register-username').select();
                    return;
                }
                
                // زیادکردنی بەکارهێنەری نوێ
                const newUser = {
                    id: Date.now(),
                    name: name,
                    username: username,
                    password: password,
                    phone: phone,
                    role: 'user',
                    isAdmin: false,
                    createdAt: new Date().toISOString()
                };
                
                users.push(newUser);
                currentUser = newUser;
                
                // "لەبیرم مەکە" بۆ بەکارهێنەرە نوێیەکانیش
                if (document.getElementById('remember-me').checked) {
                    localStorage.setItem('rememberedUser', JSON.stringify({username: username, password: password}));
                }
                
                saveUserData();
                showMainApp();
                showNotification('بەکارهێنەر بە سەرکەوتوویی دروستکرا!');
                
                if (settings.vibration && 'vibrate' in navigator) {
                    navigator.vibrate(100);
                }
            });
            
            // دوگمەی Logout
            document.getElementById('logout-btn').addEventListener('click', function() {
                currentUser = null;
                localStorage.removeItem('rememberedUser');
                saveUserData();
                showAuthPage();
                showNotification('بە سەرکەوتوویی چووتە دەرەوە!');
            });
        }

        // دروستکردنی بەکارهێنەرە ئەدمینەکان
        function createAdminUsers() {
            console.log('دروستکردنی بەکارهێنەرە ئەدمینەکان...');
            users = [
                {
                    id: 1,
                    name: "Mustafa",
                    username: "mustafa",
                    password: "Tdkr2713",
                    role: "admin",
                    isAdmin: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    name: "Muhamad",
                    username: "muhamad",
                    password: "Tdkr2814",
                    role: "admin",
                    isAdmin: true,
                    createdAt: new Date().toISOString()
                }
            ];
            console.log('بەکارهێنەرە ئەدمینەکان دروستکران');
        }

        // دروستکردنی پەیامی نموونەیی
        function createSampleMessages() {
            console.log('دروستکردنی پەیامی نموونەیی...');
            messages = [
                {
                    id: 1,
                    fromUserId: 3,
                    fromUserName: "عەلی کەریم",
                    toUserId: 1,
                    type: "text",
                    content: "سڵاو، من قەرزێکی نوێم هەیە کە دەمەوێت زیاد بکەم. دەتوانیت یارمەتیم بدەیت؟",
                    read: true,
                    timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).getTime()
                },
                {
                    id: 2,
                    fromUserId: 4,
                    fromUserName: "سارە عەبدوڵڵا",
                    toUserId: 2,
                    type: "text",
                    content: "ژمارەی قەرزەکانم چەندە؟",
                    read: false,
                    timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).getTime()
                },
                {
                    id: 3,
                    fromUserId: 1,
                    fromUserName: "Mustafa",
                    toUserId: 3,
                    type: "text",
                    content: "بەڵێ، دەتوانم یارمەتیت بدەم. چەند پارەت پێویستە؟",
                    read: true,
                    timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000 + 3600000).getTime()
                }
            ];
        }

        // دروستکردنی داتای نموونەیی
        function createSampleData() {
            console.log('دروستکردنی داتای نموونەیی...');
            people = [
                { id: 1, name: "عەلی محەممەد", phone: "07501234567", notes: "هاوکاری ماڵ", createdAt: new Date().toISOString() },
                { id: 2, name: "سارە عەبدوڵڵا", phone: "07701234567", notes: "هاوکاری کار", createdAt: new Date().toISOString() },
                { id: 3, name: "حوسێن ڕەسوڵ", phone: "07511234567", notes: "هاوکاری خزم", createdAt: new Date().toISOString() }
            ];
            
            const now = new Date();
            const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
            
            debts = [
                { id: 1, personId: 1, amount: 150000, date: now.toISOString(), notes: "بۆ نان", status: "active", originalAmount: 150000, paidAmount: 0, createdAt: now.toISOString() },
                { id: 2, personId: 2, amount: 75000, date: now.toISOString(), notes: "بۆ سووتەمەنی", status: "active", originalAmount: 75000, paidAmount: 25000, createdAt: now.toISOString() },
                { id: 3, personId: 3, amount: 200000, date: lastMonth.toISOString(), notes: "قەرزی کۆن", status: "overdue", originalAmount: 200000, paidAmount: 0, createdAt: lastMonth.toISOString() }
            ];
            
            payments = [
                { id: 1, debtId: 2, amount: 25000, date: now.toISOString(), notes: "یەکەم پارەدان", createdAt: now.toISOString() }
            ];
            
            createAdminUsers();
            createSampleMessages();
            
            saveUserData();
            console.log('داتای نموونەیی دروستکرا');
        }

        // ڕێکخستنی سیستمێکی بەرواری خۆکار
        function setupAutoDateSystem() {
            // چێککردن بۆ گۆڕانکاری لە سویچی بەرواری خۆکار
            const autoDateSwitch = document.getElementById('auto-date');
            if (autoDateSwitch) {
                autoDateSwitch.addEventListener('change', function() {
                    settings.autoDate = this.checked;
                    saveUserData();
                    updateAutoDateFields();
                });
            }
            
            // دانانی بەرواری ئەمڕۆ بۆ هەموو خانەکانی بەروار
            updateAutoDateFields();
        }

        // دانانی بەرواری خۆکار بۆ خانەکان
        function setAutoDateFields(dateValue) {
            const dateFields = [
                'quick-date',
                'debt-date',
                'general-payment-date'
            ];
            
            dateFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.value = dateValue;
                }
            });
        }

        // نوێکردنەوەی خانەکانی بەروار بەپێی ڕێکخستنەکان
        function updateAutoDateFields() {
            const today = new Date().toISOString().split('T')[0];
            
            if (settings.autoDate) {
                setAutoDateFields(today);
                
                // نیشاندانی ئاگاداری بەرواری خۆکار
                const indicators = document.querySelectorAll('.auto-date-indicator');
                indicators.forEach(indicator => {
                    indicator.style.display = 'flex';
                });
            } else {
                // لێکردنەوەی ئاگاداری بەرواری خۆکار
                const indicators = document.querySelectorAll('.auto-date-indicator');
                indicators.forEach(indicator => {
                    indicator.style.display = 'none';
                });
            }
        }

        // نوێکردنەوەی Badge بۆ بەکارهێنەر
        function updateUserBadge() {
            const userBadge = document.getElementById('user-badge');
            if (currentUser) {
                if (currentUser.isAdmin) {
                    userBadge.innerHTML = `<div style="background-color: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 20px; margin-bottom: 10px; font-size: 0.9rem;">ئەدمین: ${currentUser.name}</div>`;
                } else {
                    userBadge.innerHTML = `<div style="background-color: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 20px; margin-bottom: 10px; font-size: 0.9rem;">بەکارهێنەر: ${currentUser.name}</div>`;
                }
            } else {
                userBadge.innerHTML = '';
            }
        }

        // نوێکردنەوەی دەستەواژەی دوگمەکان بەپێی ئاستی بەکارهێنەر
        function updateButtonPermissions() {
            const isAdmin = currentUser && currentUser.isAdmin;
            
            // دوگمەی زیادکردنی کەس
            const addPersonBtn = document.getElementById('add-person');
            if (addPersonBtn) {
                if (!isAdmin) {
                    addPersonBtn.disabled = true;
                    addPersonBtn.innerHTML = '<i class="fas fa-lock"></i> قفڵکراوە';
                    addPersonBtn.style.opacity = '0.6';
                    addPersonBtn.style.cursor = 'not-allowed';
                } else {
                    addPersonBtn.disabled = false;
                    addPersonBtn.innerHTML = '<i class="fas fa-plus"></i> زیادکردنی کەس';
                    addPersonBtn.style.opacity = '1';
                    addPersonBtn.style.cursor = 'pointer';
                }
            }
            
            // دوگمەی دەستکاری لە وردەکاری کەس
            const editPersonBtn = document.getElementById('edit-person-profile');
            const deletePersonBtn = document.getElementById('delete-person-profile');
            const addDebtBtn = document.getElementById('add-debt-to-person');
            
            if (editPersonBtn) {
                if (!isAdmin) {
                    editPersonBtn.disabled = true;
                    editPersonBtn.innerHTML = '<i class="fas fa-lock"></i> قفڵکراوە';
                    editPersonBtn.style.opacity = '0.6';
                    editPersonBtn.style.cursor = 'not-allowed';
                } else {
                    editPersonBtn.disabled = false;
                    editPersonBtn.innerHTML = '<i class="fas fa-edit"></i> دەستکاری';
                    editPersonBtn.style.opacity = '1';
                    editPersonBtn.style.cursor = 'pointer';
                }
            }
            
            if (deletePersonBtn) {
                if (!isAdmin) {
                    deletePersonBtn.disabled = true;
                    deletePersonBtn.innerHTML = '<i class="fas fa-lock"></i> قفڵکراوە';
                    deletePersonBtn.style.opacity = '0.6';
                    deletePersonBtn.style.cursor = 'not-allowed';
                } else {
                    deletePersonBtn.disabled = false;
                    deletePersonBtn.innerHTML = '<i class="fas fa-trash"></i> سڕینەوە';
                    deletePersonBtn.style.opacity = '1';
                    deletePersonBtn.style.cursor = 'pointer';
                }
            }
            
            if (addDebtBtn) {
                if (!isAdmin) {
                    addDebtBtn.disabled = true;
                    addDebtBtn.innerHTML = '<i class="fas fa-lock"></i> قفڵکراوە';
                    addDebtBtn.style.opacity = '0.6';
                    addDebtBtn.style.cursor = 'not-allowed';
                } else {
                    addDebtBtn.disabled = false;
                    addDebtBtn.innerHTML = '<i class="fas fa-plus"></i> قەرزی نوێ';
                    addDebtBtn.style.opacity = '1';
                    addDebtBtn.style.cursor = 'pointer';
                }
            }
            
            // دوگمەی دەستکاری لە وردەکاری قەرز
            const editDebtBtn = document.getElementById('edit-debt');
            const deleteDebtBtn = document.getElementById('delete-debt');
            const addSpecificPaymentBtn = document.getElementById('add-specific-payment');
            
            if (editDebtBtn) {
                if (!isAdmin) {
                    editDebtBtn.disabled = true;
                    editDebtBtn.innerHTML = '<i class="fas fa-lock"></i> قفڵکراوە';
                    editDebtBtn.style.opacity = '0.6';
                    editDebtBtn.style.cursor = 'not-allowed';
                } else {
                    editDebtBtn.disabled = false;
                    editDebtBtn.innerHTML = '<i class="fas fa-edit"></i> دەستکاری';
                    editDebtBtn.style.opacity = '1';
                    editDebtBtn.style.cursor = 'pointer';
                }
            }
            
            if (deleteDebtBtn) {
                if (!isAdmin) {
                    deleteDebtBtn.disabled = true;
                    deleteDebtBtn.innerHTML = '<i class="fas fa-lock"></i> قفڵکراوە';
                    deleteDebtBtn.style.opacity = '0.6';
                    deleteDebtBtn.style.cursor = 'not-allowed';
                } else {
                    deleteDebtBtn.disabled = false;
                    deleteDebtBtn.innerHTML = '<i class="fas fa-trash"></i> سڕینەوە';
                    deleteDebtBtn.style.opacity = '1';
                    deleteDebtBtn.style.cursor = 'pointer';
                }
            }
            
            if (addSpecificPaymentBtn) {
                if (!isAdmin) {
                    addSpecificPaymentBtn.disabled = true;
                    addSpecificPaymentBtn.innerHTML = '<i class="fas fa-lock"></i> قفڵکراوە';
                    addSpecificPaymentBtn.style.opacity = '0.6';
                    addSpecificPaymentBtn.style.cursor = 'not-allowed';
                } else {
                    addSpecificPaymentBtn.disabled = false;
                    addSpecificPaymentBtn.innerHTML = '<i class="fas fa-money-bill-wave"></i> پارەدان';
                    addSpecificPaymentBtn.style.opacity = '1';
                    addSpecificPaymentBtn.style.cursor = 'pointer';
                }
            }
        }

        // بارکردنی لیستی کەسەکان
        function loadPeopleList() {
            const personList = document.getElementById('person-list');
            personList.innerHTML = '';
            
            if (people.length === 0) {
                personList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>هیچ کەسێک نیە</h3>
                        <p>یەکەم کەس زیاد بکە بۆ دەستپێکردن</p>
                        <button class="btn btn-primary" id="add-first-person" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i>
                            یەکەم کەس زیاد بکە
                        </button>
                    </div>
                `;
                
                document.getElementById('add-first-person').addEventListener('click', function() {
                    showAddPersonView();
                });
                return;
            }
            
            people.forEach(person => {
                const personDebts = debts.filter(debt => debt.personId === person.id && debt.status !== 'paid');
                const totalDebt = personDebts.reduce((sum, debt) => sum + (debt.amount || 0), 0);
                
                const personItem = document.createElement('div');
                personItem.className = 'person-item';
                personItem.dataset.id = person.id;
                personItem.innerHTML = `
                    <div class="person-info">
                        <h3>${person.name}</h3>
                        <p>${person.phone}</p>
                        <p><small>کۆی قەرز: ${formatCurrency(totalDebt)}</small></p>
                    </div>
                    <div>
                        <i class="fas fa-chevron-left"></i>
                    </div>
                `;
                
                // یەک کلیک: زیادکردنی قەرز
                let clickTimer;
                personItem.addEventListener('click', function(e) {
                    clearTimeout(clickTimer);
                    if (e.detail === 1) {
                        clickTimer = setTimeout(function() {
                            showAddDebtView(person.id);
                        }, 300);
                    }
                });
                
                // دوو کلیک: پڕۆفایلی کەس
                personItem.addEventListener('dblclick', function(e) {
                    clearTimeout(clickTimer);
                    showPersonProfile(person.id);
                });
                
                personList.appendChild(personItem);
            });
        }

        // بارکردنی لیستی قەرزی خێرا
        function loadQuickDebtList() {
            const quickDebtList = document.getElementById('quick-debt-list');
            const quickDebts = debts.filter(debt => debt.status === 'quick');
            
            quickDebtList.innerHTML = '';
            
            if (quickDebts.length === 0) {
                quickDebtList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bolt"></i>
                        <h3>هیچ قەرزی خێرا نیە</h3>
                        <p>قەرزە خێراکان لێرە دەردەکەون</p>
                    </div>
                `;
                return;
            }
            
            quickDebts.forEach(debt => {
                const debtItem = document.createElement('div');
                debtItem.className = 'debt-item';
                debtItem.dataset.id = debt.id;
                
                debtItem.innerHTML = `
                    <div class="debt-info">
                        <h3>قەرزی خێرا</h3>
                        <p>${formatDate(new Date(debt.date).toISOString())} - ${debt.notes || '(بێ تێبینی)'}</p>
                        <p><small>${debt.personName || 'نەناسراو'}</small></p>
                    </div>
                    <div class="debt-amount">
                        ${formatCurrency(debt.amount)}
                    </div>
                `;
                
                debtItem.addEventListener('dblclick', function() {
                    showDebtDetail(debt.id);
                });
                
                quickDebtList.appendChild(debtItem);
            });
        }

        // فۆرماتی بەروار
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffDays === 0) {
                return 'ئەمڕۆ';
            } else if (diffDays === 1) {
                return 'دوێنێ';
            } else if (diffDays < 7) {
                return `${diffDays} ڕۆژ لەمەوپێش`;
            } else {
                return date.toLocaleDateString('fa-IR');
            }
        }

        // فۆرماتی پارە (ژمارەکان بە ئینگلیزی)
        function formatCurrency(amount) {
            return amount.toLocaleString('en-US') + ' دینار';
        }

        // ڕێکخستنی تابەکان
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const pages = document.querySelectorAll('.page');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const pageId = this.dataset.page;
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    pages.forEach(page => {
                        page.classList.remove('active');
                        if (page.id === pageId) {
                            page.classList.add('active');
                        }
                    });
                    
                    document.querySelectorAll('.nav-item').forEach(navItem => {
                        navItem.classList.remove('active');
                        if (navItem.dataset.page === pageId) {
                            navItem.classList.add('active');
                        }
                    });
                    
                    if (pageId === 'report') {
                        loadReport();
                    }
                    
                    if (pageId === 'chat') {
                        loadContacts();
                    }
                    
                    if (settings.vibration && 'vibrate' in navigator) {
                        navigator.vibrate(30);
                    }
                });
            });
        }

        // ڕێکخستنی فۆرمەکان
        function setupForms() {
            // فۆرمی قەرزی خێرا
            document.getElementById('quick-debt-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('quick-name').value;
                const phone = document.getElementById('quick-phone').value;
                const amount = parseInt(document.getElementById('quick-amount').value);
                const date = document.getElementById('quick-date').value;
                const notes = document.getElementById('quick-notes').value;
                
                const newDebt = {
                    id: Date.now(),
                    personName: name,
                    personPhone: phone,
                    amount: amount,
                    originalAmount: amount,
                    date: date,
                    notes: notes,
                    status: 'quick',
                    paidAmount: 0,
                    createdAt: new Date().toISOString()
                };
                
                debts.push(newDebt);
                saveUserData();
                
                this.reset();
                document.getElementById('quick-date').value = new Date().toISOString().split('T')[0];
                
                loadQuickDebtList();
                loadReport();
                
                showNotification('قەرزی خێرا بە سەرکەوتوویی زیادکرا!');
                
                if (settings.vibration && 'vibrate' in navigator) {
                    navigator.vibrate(100);
                }
            });
            
            // فۆرمی زیادکردنی کەس
            document.getElementById('add-person-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('person-name').value;
                const phone = document.getElementById('person-phone').value;
                const notes = document.getElementById('person-notes').value;
                
                const newPerson = {
                    id: Date.now(),
                    name: name,
                    phone: phone,
                    notes: notes,
                    createdAt: new Date().toISOString()
                };
                
                people.push(newPerson);
                saveUserData();
                
                hideAddPersonView();
                this.reset();
                
                loadPeopleList();
                loadReport();
                
                showNotification('کەس بە سەرکەوتوویی زیادکرا!');
                
                if (settings.vibration && 'vibrate' in navigator) {
                    navigator.vibrate(100);
                }
            });
            
            // فۆرمی زیادکردنی قەرز
            document.getElementById('add-debt-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const personId = parseInt(document.getElementById('debt-person').value);
                const amount = parseInt(document.getElementById('debt-amount').value);
                const date = document.getElementById('debt-date').value;
                const notes = document.getElementById('debt-notes').value;
                
                const newDebt = {
                    id: Date.now(),
                    personId: personId,
                    amount: amount,
                    originalAmount: amount,
                    date: date,
                    notes: notes,
                    status: 'active',
                    paidAmount: 0,
                    createdAt: new Date().toISOString()
                };
                
                debts.push(newDebt);
                saveUserData();
                
                hideAddDebtView();
                this.reset();
                document.getElementById('debt-date').value = new Date().toISOString().split('T')[0];
                
                loadPeopleList();
                loadReport();
                
                showNotification('قەرز بە سەرکەوتوویی زیادکرا!');
                
                if (settings.vibration && 'vibrate' in navigator) {
                    navigator.vibrate(100);
                }
            });
            
            // فۆرمی پارەدانی گشتی (واسڵکردن)
            document.getElementById('general-payment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const paymentAmount = parseInt(document.getElementById('general-payment-amount').value);
                const paymentDate = document.getElementById('general-payment-date').value;
                const paymentNotes = document.getElementById('general-payment-notes').value;
                
                if (!currentPersonId) {
                    showNotification('هیچ کەسێک دیاری نەکراوە!', 'error');
                    return;
                }
                
                const person = people.find(p => p.id === currentPersonId);
                if (!person) {
                    showNotification('کەسەکە نەدۆزرایەوە!', 'error');
                    return;
                }
                
                // ئەنجامدانی واسڵکردن
                const result = applyGeneralPayment(currentPersonId, paymentAmount, paymentDate, paymentNotes);
                
                if (result.success) {
                    this.reset();
                    document.getElementById('general-payment-date').value = new Date().toISOString().split('T')[0];
                    
                    hideGeneralPaymentView();
                    showPersonProfile(currentPersonId);
                    
                    loadPeopleList();
                    loadReport();
                    
                    showNotification(`واسڵکردن بە سەرکەوتوویی ئەنجامدرا! ${formatCurrency(paymentAmount)}`);
                    
                    if (settings.vibration && 'vibrate' in navigator) {
                        navigator.vibrate(100);
                    }
                } else {
                    showNotification(result.message, 'error');
                }
            });
        }

        // ئەنجامدانی پارەدانی گشتی
        function applyGeneralPayment(personId, paymentAmount, paymentDate, paymentNotes) {
            if (paymentAmount <= 0) {
                return { success: false, message: 'بڕی پارە نابێت بچووکتر یان یەکسان بێت بە صفر!' };
            }
            
            // گەڕان بۆ قەرزە چالاکەکانی کەسەکە
            const personDebts = debts.filter(debt => 
                debt.personId === personId && 
                debt.status !== 'paid' && 
                debt.amount > 0
            );
            
            if (personDebts.length === 0) {
                return { success: false, message: 'کەسەکە هیچ قەرزی چالاکی نیە!' };
            }
            
            // کۆی قەرزە چالاکەکان
            const totalActiveDebt = personDebts.reduce((sum, debt) => sum + (debt.amount || 0), 0);
            
            if (paymentAmount > totalActiveDebt) {
                return { success: false, message: `بڕی پارەی دراو نابێت زیاتر بێت لە ${formatCurrency(totalActiveDebt)}!` };
            }
            
            let remainingPayment = paymentAmount;
            
            // پارەدان بۆ هەر قەرزێک بە شێوەی یەک لە دوای یەک
            for (const debt of personDebts) {
                if (remainingPayment <= 0) break;
                
                const debtRemaining = debt.amount || 0;
                
                if (debtRemaining > 0) {
                    const paymentForThisDebt = Math.min(remainingPayment, debtRemaining);
                    
                    // دروستکردنی پارەدان
                    const newPayment = {
                        id: Date.now() + Math.random(),
                        debtId: debt.id,
                        amount: paymentForThisDebt,
                        date: paymentDate,
                        notes: paymentNotes + (paymentNotes ? ' - ' : '') + `پارەدانی گشتی (واسڵکردن)`,
                        createdAt: new Date().toISOString()
                    };
                    
                    payments.push(newPayment);
                    
                    // نوێکردنەوەی قەرز
                    debt.paidAmount = (debt.paidAmount || 0) + paymentForThisDebt;
                    debt.amount = debtRemaining - paymentForThisDebt;
                    
                    // ئەگەر پارەدراو تەواو بوو
                    if (debt.paidAmount >= debt.originalAmount) {
                        debt.status = 'paid';
                        debt.amount = 0;
                    }
                    
                    remainingPayment -= paymentForThisDebt;
                }
            }
            
            saveUserData();
            return { success: true, message: 'پارەدان بە سەرکەوتوویی ئەنجامدرا' };
        }

        // ڕێکخستنی وردەکاری
        function setupDetailViews() {
            // دوگمەکانی داخستن
            document.querySelectorAll('.close-detail').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.detail-view').forEach(view => {
                        view.classList.remove('active');
                    });
                });
            });
            
            // زیادکردنی کەس
            document.getElementById('add-person').addEventListener('click', function() {
                showAddPersonView();
            });
            
            // دەستکاری کەس
            document.getElementById('edit-person-profile').addEventListener('click', function() {
                if (currentPersonId) {
                    editPerson(currentPersonId);
                }
            });
            
            // سڕینەوەی کەس
            document.getElementById('delete-person-profile').addEventListener('click', function() {
                if (currentPersonId) {
                    deletePerson(currentPersonId);
                }
            });
            
            // زیادکردنی قەرز بۆ کەس
            document.getElementById('add-debt-to-person').addEventListener('click', function() {
                if (currentPersonId) {
                    showAddDebtView(currentPersonId);
                }
            });
            
            // واسڵکردنی کەس
            document.getElementById('settle-person').addEventListener('click', function() {
                if (currentPersonId) {
                    showGeneralPaymentView(currentPersonId);
                }
            });
            
            // دەستکاری قەرز
            document.getElementById('edit-debt').addEventListener('click', function() {
                if (currentDebtId) {
                    editDebt(currentDebtId);
                }
            });
            
            // سڕینەوەی قەرز
            document.getElementById('delete-debt').addEventListener('click', function() {
                if (currentDebtId) {
                    deleteDebt(currentDebtId);
                }
            });
            
            // زیادکردنی پارەدان بۆ قەرزی دیاریکراو
            document.getElementById('add-specific-payment').addEventListener('click', function() {
                if (currentDebtId) {
                    showSpecificPaymentView(currentDebtId);
                } else {
                    showNotification('تکایە یەک قەرز هەڵبژێرە بۆ پارەدان!', 'error');
                }
            });
        }

        // نیشاندانی پڕۆفایلی کەس
        function showPersonProfile(personId) {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، دەستکاری نەکات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن دەستکاری بکەن!', 'warning');
                return;
            }
            
            const person = people.find(p => p.id === personId);
            if (!person) return;
            
            currentPersonId = personId;
            currentDebtId = null;
            
            const personDebts = debts.filter(debt => debt.personId === personId);
            const totalOriginal = personDebts.reduce((sum, debt) => sum + (debt.originalAmount || debt.amount || 0), 0);
            const totalPaid = personDebts.reduce((sum, debt) => sum + (debt.paidAmount || 0), 0);
            const remaining = totalOriginal - totalPaid;
            const activeDebts = personDebts.filter(debt => debt.status === 'active');
            const overdueDebts = personDebts.filter(debt => debt.status === 'overdue');
            const quickDebts = personDebts.filter(debt => debt.status === 'quick');
            const paidDebts = personDebts.filter(debt => debt.status === 'paid');
            
            // پارەدانە گشتیەکان
            const personGeneralPayments = payments.filter(payment => {
                const debt = debts.find(d => d.id === payment.debtId);
                return debt && debt.personId === personId;
            }).sort((a, b) => new Date(b.date) - new Date(a.date));
            
            document.getElementById('person-profile-title').textContent = person.name;
            document.getElementById('person-profile-subtitle').textContent = person.phone;
            
            let content = `
                <div class="form-group">
                    <label>ناوی تەواو</label>
                    <div class="form-control" style="background-color: var(--light-color);">${person.name}</div>
                </div>
                <div class="form-group">
                    <label>ژمارەی مۆبایل</label>
                    <div class="form-control" style="background-color: var(--light-color);">${person.phone}</div>
                </div>
                <div class="form-group">
                    <label>تێبینی</label>
                    <div class="form-control" style="background-color: var(--light-color); min-height: 60px;">${person.notes || '(بێ تێبینی)'}</div>
                </div>
                <div class="stats" style="margin-top: 20px;">
                    <div class="stat-item">
                        <div class="stat-value">${formatCurrency(totalOriginal)}</div>
                        <div class="stat-label">کۆی قەرز</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${formatCurrency(totalPaid)}</div>
                        <div class="stat-label">پارەدراو</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${formatCurrency(remaining)}</div>
                        <div class="stat-label">ماوە</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${personDebts.length}</div>
                        <div class="stat-label">ژمارەی قەرزەکان</div>
                    </div>
                </div>
            `;
            
            if (personGeneralPayments.length > 0) {
                content += `
                    <div class="form-group" style="margin-top: 20px;">
                        <label>مێژووی واسڵکردنەکان</label>
                        <div class="payment-history">
                `;
                
                personGeneralPayments.forEach(payment => {
                    const debt = debts.find(d => d.id === payment.debtId);
                    const debtNote = debt ? debt.notes : '';
                    
                    content += `
                        <div class="payment-history-item">
                            <div>
                                <div><strong>${formatCurrency(payment.amount)}</strong></div>
                                <div style="color: #666; font-size: 0.85rem;">${formatDate(new Date(payment.date).toISOString())}</div>
                                <div style="color: #666; font-size: 0.8rem;">${debtNote}</div>
                            </div>
                            <div style="color: #999; font-size: 0.8rem;">
                                ${payment.notes || ''}
                            </div>
                        </div>
                    `;
                });
                
                content += `</div></div>`;
            }
            
            if (activeDebts.length > 0 || quickDebts.length > 0) {
                content += `
                    <div class="form-group" style="margin-top: 20px;">
                        <label>قەرزە چالاکەکان (کۆی: ${formatCurrency(activeDebts.concat(quickDebts).reduce((sum, debt) => sum + (debt.amount || 0), 0))})</label>
                        <div style="background-color: var(--light-color); border-radius: var(--border-radius); padding: 15px; max-height: 200px; overflow-y: auto;">
                `;
                
                [...activeDebts, ...quickDebts].forEach(debt => {
                    const originalAmount = debt.originalAmount || debt.amount;
                    const paidAmount = debt.paidAmount || 0;
                    const remainingAmount = originalAmount - paidAmount;
                    const isQuick = debt.status === 'quick';
                    
                    content += `
                        <div style="padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.05); cursor: pointer;" onclick="showDebtDetail(${debt.id})">
                            <div style="display: flex; justify-content: space-between;">
                                <span><strong>${formatCurrency(remainingAmount)}</strong> ${isQuick ? '<span class="badge" style="font-size: 0.7rem; padding: 2px 6px;">خێرا</span>' : ''}</span>
                                <span style="color: #666; font-size: 0.9rem;">${formatDate(new Date(debt.date).toISOString())}</span>
                            </div>
                            <div style="color: #666; font-size: 0.9rem;">${debt.notes || '(بێ تێبینی)'}</div>
                            ${paidAmount > 0 ? `<div style="color: var(--success-color); font-size: 0.85rem;">پارەدراو: ${formatCurrency(paidAmount)}</div>` : ''}
                        </div>
                    `;
                });
                
                content += `</div></div>`;
            }
            
            if (overdueDebts.length > 0) {
                content += `
                    <div class="form-group" style="margin-top: 20px;">
                        <label>قەرزە کۆنەکان (کۆی: ${formatCurrency(overdueDebts.reduce((sum, debt) => sum + (debt.amount || 0), 0))})</label>
                        <div style="background-color: var(--light-color); border-radius: var(--border-radius); padding: 15px; max-height: 150px; overflow-y: auto;">
                `;
                
                overdueDebts.forEach(debt => {
                    const originalAmount = debt.originalAmount || debt.amount;
                    const paidAmount = debt.paidAmount || 0;
                    const remainingAmount = originalAmount - paidAmount;
                    
                    content += `
                        <div style="padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.05); cursor: pointer;" onclick="showDebtDetail(${debt.id})">
                            <div style="display: flex; justify-content: space-between;">
                                <span><strong>${formatCurrency(remainingAmount)}</strong> <span class="badge badge-danger" style="font-size: 0.7rem; padding: 2px 6px;">کۆن</span></span>
                                <span style="color: #666; font-size: 0.9rem;">${formatDate(new Date(debt.date).toISOString())}</span>
                            </div>
                            <div style="color: #666; font-size: 0.9rem;">${debt.notes || '(بێ تێبینی)'}</div>
                        </div>
                    `;
                });
                
                content += `</div></div>`;
            }
            
            document.getElementById('person-profile-content').innerHTML = content;
            document.getElementById('person-profile-view').classList.add('active');
        }

        // نیشاندانی زیادکردنی کەس
        function showAddPersonView() {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، دەستکاری نەکات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن کەس زیاد بکەن!', 'warning');
                return;
            }
            
            document.getElementById('add-person-view').classList.add('active');
        }

        // نیشاندانی زیادکردنی قەرز
        function showAddDebtView(personId) {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، دەستکاری نەکات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن قەرز زیاد بکەن!', 'warning');
                return;
            }
            
            const select = document.getElementById('debt-person');
            select.innerHTML = '';
            
            people.forEach(person => {
                const option = document.createElement('option');
                option.value = person.id;
                option.textContent = person.name;
                if (person.id === personId) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
            
            if (personId) {
                const person = people.find(p => p.id === personId);
                if (person) {
                    document.getElementById('add-debt-subtitle').textContent = `قەرزی ${person.name}`;
                }
            }
            
            document.getElementById('add-debt-view').classList.add('active');
        }

        // نیشاندانی وردەکاری قەرز
        function showDebtDetail(debtId) {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، وردەکاری نیشان نەدات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن وردەکاری قەرز ببینن!', 'warning');
                return;
            }
            
            const debt = debts.find(d => d.id === debtId);
            if (!debt) return;
            
            currentDebtId = debtId;
            currentPersonId = debt.personId || null;
            
            let personName, personPhone;
            
            if (debt.status === 'quick') {
                personName = debt.personName || 'نەناسراو';
                personPhone = debt.personPhone || 'نەناسراو';
            } else {
                const person = people.find(p => p.id === debt.personId);
                personName = person ? person.name : 'نەناسراو';
                personPhone = person ? person.phone : 'نەناسراو';
            }
            
            const originalAmount = debt.originalAmount || debt.amount;
            const paidAmount = debt.paidAmount || 0;
            const remainingAmount = originalAmount - paidAmount;
            
            document.getElementById('debt-detail-title').textContent = `قەرزی ${personName}`;
            document.getElementById('debt-detail-subtitle').textContent = formatCurrency(remainingAmount);
            
            const statusText = debt.status === 'active' ? 'چالاک' : 
                             debt.status === 'overdue' ? 'کۆن' : 
                             debt.status === 'paid' ? 'پارەدراو' : 'خێرا';
            
            // گەڕان بۆ پارەدانەکانی ئەم قەرزە
            const debtPayments = payments.filter(payment => payment.debtId === debtId);
            
            let content = `
                <div class="form-group">
                    <label>کەس</label>
                    <div class="form-control" style="background-color: var(--light-color);">${personName}</div>
                </div>
                <div class="form-group">
                    <label>ژمارەی مۆبایل</label>
                    <div class="form-control" style="background-color: var(--light-color);">${personPhone}</div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>بڕی ڕەسەنی قەرز</label>
                        <div class="form-control" style="background-color: var(--light-color);">${formatCurrency(originalAmount)}</div>
                    </div>
                    <div class="form-group">
                        <label>بڕی پارەدراو</label>
                        <div class="form-control" style="background-color: var(--light-color);">${formatCurrency(paidAmount)}</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>بڕی ماوە</label>
                        <div class="form-control" style="background-color: var(--light-color); font-weight: bold; color: var(--primary-color);">${formatCurrency(remainingAmount)}</div>
                    </div>
                    <div class="form-group">
                        <label>بەروار</label>
                        <div class="form-control" style="background-color: var(--light-color);">${formatDate(new Date(debt.date).toISOString())}</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>تێبینی</label>
                    <div class="form-control" style="background-color: var(--light-color); min-height: 60px;">${debt.notes || '(بێ تێبینی)'}</div>
                </div>
                <div class="form-group">
                    <label>دۆخ</label>
                    <div class="form-control" style="background-color: var(--light-color);">
                        ${statusText}
                    </div>
                </div>
            `;
            
            if (debtPayments.length > 0) {
                content += `
                    <div class="form-group" style="margin-top: 20px;">
                        <label>مێژووی پارەدانەکان</label>
                        <div style="background-color: var(--light-color); border-radius: var(--border-radius); padding: 15px; max-height: 200px; overflow-y: auto;">
                `;
                
                debtPayments.forEach(payment => {
                    content += `
                        <div style="padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                            <div style="display: flex; justify-content: space-between;">
                                <span><strong>${formatCurrency(payment.amount)}</strong></span>
                                <span style="color: #666; font-size: 0.9rem;">${formatDate(new Date(payment.date).toISOString())}</div>
                                <div style="color: #666; font-size: 0.9rem;">${payment.notes || '(بێ تێبینی)'}</div>
                            </div>
                        </div>
                    `;
                });
                
                content += `</div></div>`;
            }
            
            document.getElementById('debt-detail-content').innerHTML = content;
            document.getElementById('debt-detail-view').classList.add('active');
        }

        // نیشاندانی پەنجەرەی پارەدانی گشتی (واسڵکردن)
        function showGeneralPaymentView(personId) {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، دەستکاری نەکات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن واسڵکردن بکەن!', 'warning');
                return;
            }
            
            const person = people.find(p => p.id === personId);
            if (!person) return;
            
            currentPersonId = personId;
            
            // کۆی قەرزە چالاکەکان
            const activeDebts = debts.filter(debt => 
                debt.personId === personId && 
                debt.status !== 'paid' && 
                debt.amount > 0
            );
            
            const totalActiveDebt = activeDebts.reduce((sum, debt) => sum + (debt.amount || 0), 0);
            
            if (totalActiveDebt <= 0) {
                showNotification('کەسەکە هیچ قەرزی چالاکی نیە!', 'warning');
                return;
            }
            
            document.getElementById('general-payment-title').textContent = `واسڵکردنی ${person.name}`;
            document.getElementById('general-payment-subtitle').textContent = formatCurrency(totalActiveDebt);
            
            let paymentContent = `
                <div class="form-group">
                    <label>کەس</label>
                    <div class="form-control" style="background-color: var(--light-color); margin-bottom: 15px;">${person.name}</div>
                </div>
                <div class="remaining-amount">
                    کۆی قەرزی چالاک: ${formatCurrency(totalActiveDebt)}
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label>قەرزە چالاکەکان</label>
                    <div style="background-color: var(--light-color); border-radius: var(--border-radius); padding: 15px; max-height: 200px; overflow-y: auto;">
            `;
            
            activeDebts.forEach(debt => {
                const originalAmount = debt.originalAmount || debt.amount;
                const paidAmount = debt.paidAmount || 0;
                const remainingAmount = originalAmount - paidAmount;
                
                paymentContent += `
                    <div style="padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                        <div style="display: flex; justify-content: space-between;">
                            <span><strong>${formatCurrency(remainingAmount)}</strong></span>
                            <span style="color: #666; font-size: 0.9rem;">${formatDate(new Date(debt.date).toISOString())}</span>
                        </div>
                        <div style="color: #666; font-size: 0.9rem;">${debt.notes || '(بێ تێبینی)'}</div>
                    </div>
                `;
            });
            
            paymentContent += `
                    </div>
                </div>
                <div style="text-align: center; color: #666; font-size: 0.9rem; margin-top: 10px; margin-bottom: 20px;">
                    پارەدانەکە بەشێوەی خۆکار دابەش دەکرێت بەسەر قەرزەکاندا
                </div>
            `;
            
            document.getElementById('general-payment-content').innerHTML = paymentContent;
            
            // دانانی بڕی کەمترین پارەدان
            document.getElementById('general-payment-amount').max = totalActiveDebt;
            document.getElementById('general-payment-amount').value = totalActiveDebt;
            document.getElementById('general-payment-amount').placeholder = `کەمتر لە ${totalActiveDebt.toLocaleString('en-US')}`;
            
            document.getElementById('general-payment-view').classList.add('active');
        }

        // نیشاندانی پەنجەرەی پارەدانی دیاریکراو
        function showSpecificPaymentView(debtId) {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، دەستکاری نەکات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن پارەدان بکەن!', 'warning');
                return;
            }
            
            const debt = debts.find(d => d.id === debtId);
            if (!debt) return;
            
            currentDebtId = debtId;
            currentPersonId = debt.personId || null;
            
            // دروستکردنی فۆرمێکی سادە بۆ پارەدانی دیاریکراو
            const person = people.find(p => p.id === currentPersonId);
            const personName = person ? person.name : 'نەناسراو';
            
            const originalAmount = debt.originalAmount || debt.amount;
            const paidAmount = debt.paidAmount || 0;
            const remainingAmount = originalAmount - paidAmount;
            
            const paymentForm = `
                <div class="form-group">
                    <label>کەس</label>
                    <div class="form-control" style="background-color: var(--light-color); margin-bottom: 15px;">${personName}</div>
                </div>
                <div class="remaining-amount">
                    بڕی ماوە: ${formatCurrency(remainingAmount)}
                </div>
                <div style="text-align: center; color: #666; font-size: 0.9rem; margin-top: 10px; margin-bottom: 20px;">
                    تێبینی قەرز: ${debt.notes || '(بێ تێبینی)'}
                </div>
                <form id="specific-payment-form">
                    <div class="form-group">
                        <label for="specific-payment-amount">بڕی پارەی دراو (دینار)</label>
                        <input type="number" id="specific-payment-amount" class="form-control" min="1" max="${remainingAmount}" value="${remainingAmount}" required>
                    </div>
                    <div class="form-group">
                        <label for="specific-payment-date">بەرواری پارەدان</label>
                        <input type="date" id="specific-payment-date" class="form-control" value="${new Date().toISOString().split('T')[0]}" required>
                    </div>
                    <div class="form-group">
                        <label for="specific-payment-notes">تێبینی (ئارەزوومەندانە)</label>
                        <textarea id="specific-payment-notes" class="form-control" rows="3" placeholder="تێبینیێک بۆ ئەم پارەدانە زیاد بکە"></textarea>
                    </div>
                    <button type="submit" class="btn btn-success btn-block">
                        <i class="fas fa-check"></i>
                        تەواوکردنی پارەدان
                    </button>
                </form>
            `;
            
            const paymentView = document.createElement('div');
            paymentView.className = 'detail-view';
            paymentView.id = 'specific-payment-view';
            paymentView.innerHTML = `
                <div class="detail-header">
                    <div>
                        <h3>پارەدان بۆ ${personName}</h3>
                        <p>${formatCurrency(remainingAmount)}</p>
                    </div>
                    <button class="close-detail" id="close-specific-payment">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="detail-content">
                    ${paymentForm}
                </div>
            `;
            
            document.body.appendChild(paymentView);
            
            // داخستنی پەنجەرە
            document.getElementById('close-specific-payment').addEventListener('click', function() {
                document.getElementById('specific-payment-view').remove();
            });
            
            // فۆرمی پارەدان
            setTimeout(() => {
                document.getElementById('specific-payment-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const paymentAmount = parseInt(document.getElementById('specific-payment-amount').value);
                    const paymentDate = document.getElementById('specific-payment-date').value;
                    const paymentNotes = document.getElementById('specific-payment-notes').value;
                    
                    if (paymentAmount > remainingAmount) {
                        showNotification(`بڕی پارەی دراو نابێت زیاتر بێت لە ${formatCurrency(remainingAmount)}!`, 'error');
                        return;
                    }
                    
                    if (paymentAmount <= 0) {
                        showNotification('بڕی پارە نابێت بچووکتر یان یەکسان بێت بە صفر!', 'error');
                        return;
                    }
                    
                    // زیادکردنی پارەدان
                    const newPayment = {
                        id: Date.now(),
                        debtId: debtId,
                        amount: paymentAmount,
                        date: paymentDate,
                        notes: paymentNotes,
                        createdAt: new Date().toISOString()
                    };
                    
                    payments.push(newPayment);
                    
                    // نوێکردنەوەی قەرز
                    debt.paidAmount = (debt.paidAmount || 0) + paymentAmount;
                    
                    // ئەگەر پارەدراو تەواو بوو
                    if (debt.paidAmount >= originalAmount) {
                        debt.status = 'paid';
                        debt.amount = 0;
                    } else {
                        debt.amount = originalAmount - debt.paidAmount;
                    }
                    
                    saveUserData();
                    
                    document.getElementById('specific-payment-view').remove();
                    
                    if (currentPersonId) {
                        showPersonProfile(currentPersonId);
                    } else {
                        hideDebtDetailView();
                    }
                    
                    loadPeopleList();
                    loadReport();
                    
                    showNotification(`پارەدان بە سەرکەوتوویی تۆمارکرا! ${formatCurrency(paymentAmount)}`);
                    
                    if (settings.vibration && 'vibrate' in navigator) {
                        navigator.vibrate(100);
                    }
                });
            }, 100);
            
            paymentView.classList.add('active');
        }

        // دەستکاری کەس
        function editPerson(personId) {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، دەستکاری نەکات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن دەستکاری بکەن!', 'warning');
                return;
            }
            
            const person = people.find(p => p.id === personId);
            if (!person) return;
            
            const newName = prompt('ناوی نوێ:', person.name);
            if (newName === null) return;
            
            const newPhone = prompt('ژمارەی مۆبایلی نوێ:', person.phone);
            if (newPhone === null) return;
            
            const newNotes = prompt('تێبینی نوێ:', person.notes || '');
            
            person.name = newName;
            person.phone = newPhone;
            person.notes = newNotes;
            
            saveUserData();
            loadPeopleList();
            showPersonProfile(personId);
            
            showNotification('زانیارییەکانی کەس نوێکرایەوە!');
        }

        // دەستکاری قەرز
        function editDebt(debtId) {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، دەستکاری نەکات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن دەستکاری بکەن!', 'warning');
                return;
            }
            
            const debt = debts.find(d => d.id === debtId);
            if (!debt) return;
            
            const newAmount = prompt('بڕی پارەی نوێ (ڕەسەنی):', debt.originalAmount || debt.amount);
            if (newAmount === null) return;
            
            const newNotes = prompt('تێبینی نوێ:', debt.notes || '');
            
            const newAmountNum = parseInt(newAmount);
            const paidAmount = debt.paidAmount || 0;
            
            if (newAmountNum < paidAmount) {
                showNotification('بڕی ڕەسەنی قەرز نابێت کەمتر بێت لە بڕی پارەدراو!', 'error');
                return;
            }
            
            debt.originalAmount = newAmountNum;
            debt.amount = newAmountNum - paidAmount;
            debt.notes = newNotes;
            
            saveUserData();
            showDebtDetail(debtId);
            
            showNotification('قەرز نوێکرایەوە!');
        }

        // سڕینەوەی کەس
        function deletePerson(personId) {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، دەستکاری نەکات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن دەستکاری بکەن!', 'warning');
                return;
            }
            
            if (!confirm('دڵنیای لە سڕینەوەی ئەم کەسە و هەموو قەرزەکانی؟')) {
                return;
            }
            
            // سڕینەوەی هەموو پارەدانەکان بۆ قەرزەکانی ئەم کەسە
            const personDebts = debts.filter(debt => debt.personId === personId);
            personDebts.forEach(debt => {
                payments = payments.filter(payment => payment.debtId !== debt.id);
            });
            
            people = people.filter(p => p.id !== personId);
            debts = debts.filter(d => d.personId !== personId);
            
            saveUserData();
            document.getElementById('person-profile-view').classList.remove('active');
            loadPeopleList();
            loadReport();
            
            showNotification('کەس و قەرزەکانی سڕانەوە!');
        }

        // سڕینەوەی قەرز
        function deleteDebt(debtId) {
            // چێک بکە کە ئەگەر بەکارهێنەر ئەدمین نیە، دەستکاری نەکات
            if (!currentUser.isAdmin) {
                showNotification('تەنها ئەدمینەکان دەتوانن دەستکاری بکەن!', 'warning');
                return;
            }
            
            if (!confirm('دڵنیای لە سڕینەوەی ئەم قەزە و هەموو پارەدانەکانی؟')) {
                return;
            }
            
            // سڕینەوەی هەموو پارەدانەکان بۆ ئەم قەزە
            payments = payments.filter(payment => payment.debtId !== debtId);
            debts = debts.filter(d => d.id !== debtId);
            
            saveUserData();
            
            document.getElementById('debt-detail-view').classList.remove('active');
            
            if (currentPersonId) {
                showPersonProfile(currentPersonId);
            }
            
            loadPeopleList();
            loadReport();
            
            showNotification('قەز و پارەدانەکانی سڕانەوە!');
        }

        // داخستنی زیادکردنی کەس
        function hideAddPersonView() {
            document.getElementById('add-person-view').classList.remove('active');
        }

        // داخستنی زیادکردنی قەرز
        function hideAddDebtView() {
            document.getElementById('add-debt-view').classList.remove('active');
        }

        // داخستنی پارەدانی گشتی
        function hideGeneralPaymentView() {
            document.getElementById('general-payment-view').classList.remove('active');
        }

        // داخستنی وردەکاری قەرز
        function hideDebtDetailView() {
            document.getElementById('debt-detail-view').classList.remove('active');
        }

        // بارکردنی کۆنتاکتەکان
        function loadContacts() {
            const contactsList = document.getElementById('contacts-list');
            contactsList.innerHTML = '';
            
            // گەڕان بۆ هەموو بەکارهێنەرەکان جگە لە خۆی
            const otherUsers = users.filter(user => user.id !== currentUser.id);
            
            if (otherUsers.length === 0) {
                contactsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <h3>هیچ کۆنتاکتێک نیە</h3>
                        <p>هیچ بەکارهێنەرێکی تر نیە لە سیستەمەکەدا</p>
                    </div>
                `;
                return;
            }
            
            otherUsers.forEach(user => {
                // ژمارەی پەیامە نەخوێندراوەکان
                const unreadCount = messages.filter(msg => 
                    msg.toUserId === currentUser.id && 
                    msg.fromUserId === user.id && 
                    !msg.read
                ).length;
                
                const contactItem = document.createElement('div');
                contactItem.className = 'contact-item';
                contactItem.dataset.userId = user.id;
                
                // یەکەم پیتی ناوەکە بۆ ئەڤاتار
                const firstLetter = user.name.charAt(0);
                
                contactItem.innerHTML = `
                    <div class="contact-avatar">${firstLetter}</div>
                    <div class="contact-info">
                        <div class="contact-name">${user.name}</div>
                        <div class="contact-role ${user.isAdmin ? 'admin' : 'user'}">
                            ${user.isAdmin ? 'ئەدمین' : 'بەکارهێنەر'}
                        </div>
                    </div>
                    ${unreadCount > 0 ? `<div class="unread-badge">${unreadCount}</div>` : ''}
                `;
                
                contactItem.addEventListener('click', function() {
                    // لابردنی چالاکی لە هەموو کۆنتاکتەکان
                    document.querySelectorAll('.contact-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // زیادکردنی چالاکی بۆ ئەم کۆنتاکتە
                    this.classList.add('active');
                    
                    // دەستپێکردنی چات لەگەڵ ئەم بەکارهێنەرە
                    startChatWithUser(user);
                });
                
                contactsList.appendChild(contactItem);
            });
        }

        // دەستپێکردنی چات لەگەڵ بەکارهێنەرێک
        function startChatWithUser(user) {
            currentChatContact = user;
            
            // نیشاندانی سیستمێکی چات
            document.getElementById('chat-system').style.display = 'block';
            document.getElementById('no-chat-selected').style.display = 'none';
            
            // دروستکردنی چات
            setupChatWithUser(user);
        }

        // ڕێکخستنی چات لەگەڵ بەکارهێنەرێک
        function setupChatWithUser(user) {
            const chatContainer = document.getElementById('chat-container');
            
            // یەکەم پیتی ناوەکە بۆ ئەڤاتار
            const firstLetter = user.name.charAt(0);
            
            chatContainer.innerHTML = `
                <div class="chat-header">
                    <div class="chat-user-info">
                        <div class="chat-user-avatar">${firstLetter}</div>
                        <div class="chat-user-details">
                            <h3>${user.name}</h3>
                            <p>${user.username}</p>
                        </div>
                    </div>
                    <div class="chat-status online">سەرھێڵە</div>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <!-- پەیامەکان لێرە دێت -->
                </div>
                <div class="chat-input-container">
                    <textarea class="chat-input" id="chat-input" placeholder="پەیامێک بنووسە..."></textarea>
                    <button type="button" class="chat-action-btn" id="send-message-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button type="button" class="chat-action-btn" id="record-voice-btn">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                <div id="voice-recorder-container" style="display: none;">
                    <!-- تۆمارکردنی دەنگ لێرە دێت -->
                </div>
            `;
            
            // بارکردنی پەیامەکان
            loadChatMessages(user.id);
            
            // ڕێکخستنی دوگمەکانی چات
            setupChatControls(user.id);
        }

        // بارکردنی پەیامەکانی چات
        function loadChatMessages(userId) {
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = '';
            
            // گەڕان بۆ پەیامەکانی نێوان ئەم دوو بەکارهێنەرە
            const chatMessagesList = messages.filter(msg => 
                (msg.fromUserId === currentUser.id && msg.toUserId === userId) ||
                (msg.fromUserId === userId && msg.toUserId === currentUser.id)
            ).sort((a, b) => a.timestamp - b.timestamp);
            
            if (chatMessagesList.length === 0) {
                chatMessages.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-comment-slash"></i>
                        <h3>هیچ پەیامێک نیە</h3>
                        <p>یەکەم پەیامەکەت بنێرە</p>
                    </div>
                `;
                return;
            }
            
            chatMessagesList.forEach(message => {
                const isSent = message.fromUserId === currentUser.id;
                const messageTime = new Date(message.timestamp).toLocaleTimeString('fa-IR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                const messageElement = document.createElement('div');
                messageElement.className = `message ${isSent ? 'message-sent' : 'message-received'}`;
                
                if (message.type === 'text') {
                    messageElement.innerHTML = `
                        <div class="message-content">${message.content}</div>
                        <div class="message-time">${messageTime}</div>
                    `;
                } else if (message.type === 'voice') {
                    messageElement.innerHTML = `
                        <div class="voice-message-indicator">
                            <i class="fas fa-microphone"></i>
                            <div class="voice-waveform">
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                            </div>
                            <div class="voice-duration">${message.duration || '0:05'}</div>
                        </div>
                        <div class="message-time">${messageTime}</div>
                    `;
                }
                
                chatMessages.appendChild(messageElement);
                
                // نیشانەدان کە پەیامەکە خوێندراوە
                if (!message.read && message.toUserId === currentUser.id) {
                    markMessageAsRead(message.id);
                }
            });
            
            // گەڕاندنی چات بۆ خوارەوە
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ڕێکخستنی کۆنتڕۆڵەکانی چات
        function setupChatControls(userId) {
            const chatInput = document.getElementById('chat-input');
            const sendMessageBtn = document.getElementById('send-message-btn');
            const recordVoiceBtn = document.getElementById('record-voice-btn');
            
            // ناردنی پەیامی نووسین
            sendMessageBtn.addEventListener('click', function() {
                sendTextMessage(userId, chatInput.value);
                chatInput.value = '';
            });
            
            // ناردنی پەیام بە فەرمانی Enter
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendTextMessage(userId, this.value);
                    this.value = '';
                }
            });
            
            // تۆمارکردنی دەنگ
            recordVoiceBtn.addEventListener('click', function() {
                if (!isRecording) {
                    startVoiceRecording(userId);
                } else {
                    stopVoiceRecording(userId);
                }
            });
        }

        // ناردنی پەیامی نووسین
        function sendTextMessage(toUserId, content) {
            if (!content.trim()) return;
            
            const newMessage = {
                id: Date.now(),
                fromUserId: currentUser.id,
                fromUserName: currentUser.name,
                toUserId: toUserId,
                type: 'text',
                content: content.trim(),
                read: false,
                timestamp: Date.now()
            };
            
            messages.push(newMessage);
            saveUserData();
            
            // نوێکردنەوەی چات
            loadChatMessages(toUserId);
            
            // نوێکردنەوەی ژمارەی ئاگاداریەکان
            updateNotificationCount();
            
            // نمایشی پەیامی سەرکەوتوو
            showNotification('پەیامەکەت نێردرا!');
            
            if (settings.vibration && 'vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        // دەستپێکردنی تۆمارکردنی دەنگ
        async function startVoiceRecording(toUserId) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = event => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    // ناردنی پەیامی دەنگی
                    sendVoiceMessage(toUserId, audioChunks, recordingSeconds);
                };
                
                mediaRecorder.start();
                isRecording = true;
                recordingSeconds = 0;
                
                // گۆڕینی دۆخی دوگمەی دەنگ
                recordVoiceBtn.classList.add('recording');
                recordVoiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                
                // دەستپێکردنی کاتژمێر
                recordingTimer = setInterval(() => {
                    recordingSeconds++;
                }, 1000);
                
            } catch (err) {
                console.error('هەڵە لە تۆمارکردنی دەنگ:', err);
                showNotification('هەڵە لە تۆمارکردنی دەنگ!', 'error');
            }
        }

        // وەستاندنی تۆمارکردنی دەنگ
        function stopVoiceRecording(toUserId) {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                
                // وەستاندنی کاتژمێر
                clearInterval(recordingTimer);
                
                // گۆڕینی دۆخی دوگمەی دەنگ
                recordVoiceBtn.classList.remove('recording');
                recordVoiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            }
        }

        // ناردنی پەیامی دەنگی
        function sendVoiceMessage(toUserId, audioChunks, duration) {
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            const durationText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            const newMessage = {
                id: Date.now(),
                fromUserId: currentUser.id,
                fromUserName: currentUser.name,
                toUserId: toUserId,
                type: 'voice',
                content: 'پەیامی دەنگی',
                duration: durationText,
                read: false,
                timestamp: Date.now()
            };
            
            messages.push(newMessage);
            saveUserData();
            
            // نوێکردنەوەی چات
            loadChatMessages(toUserId);
            
            // نوێکردنەوەی ژمارەی ئاگاداریەکان
            updateNotificationCount();
            
            // نمایشی پەیامی سەرکەوتوو
            showNotification('پەیامی دەنگی نێردرا!');
            
            if (settings.vibration && 'vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        // نیشانەدان کە پەیامێک خوێندراوە
        function markMessageAsRead(messageId) {
            const messageIndex = messages.findIndex(msg => msg.id === messageId);
            if (messageIndex !== -1) {
                messages[messageIndex].read = true;
                saveUserData();
                updateNotificationCount();
            }
        }

        // نوێکردنەوەی ژمارەی ئاگاداریەکان
        function updateNotificationCount() {
            let unreadCount = 0;
            
            // گەڕان بۆ پەیامە نەخوێندراوەکان
            if (currentUser) {
                unreadCount = messages.filter(msg => 
                    msg.toUserId === currentUser.id && 
                    !msg.read
                ).length;
            }
            
            const notificationCounter = document.getElementById('notification-counter');
            const navNotificationCounter = document.getElementById('nav-notification-counter');
            
            if (unreadCount > 0) {
                notificationCounter.textContent = unreadCount;
                notificationCounter.style.display = 'flex';
                
                navNotificationCounter.textContent = unreadCount;
                navNotificationCounter.style.display = 'flex';
            } else {
                notificationCounter.style.display = 'none';
                navNotificationCounter.style.display = 'none';
            }
        }

        // بارکردنی بەڕێوەبردنی بەکارهێنەران (تەنها بۆ mustafa)
        function loadUserManagement() {
            if (currentUser && !currentUser.isAdmin) return;
            
            const userManagementList = document.getElementById('user-management-list');
            userManagementList.innerHTML = '';
            
            // گەڕان بۆ هەموو بەکارهێنەرەکان
            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                
                userItem.innerHTML = `
                    <div class="user-item-info">
                        <h4>${user.name}</h4>
                        <p>ناوی بەکارهێنەر: ${user.username} | ژمارەی مۆبایل: ${user.phone || 'نەناسراو'}</p>
                        <p>وشەی نهێنی: <strong>${user.password}</strong></p>
                        <p>دروستکراوە لە: ${formatDate(new Date(user.createdAt).toISOString())}</p>
                    </div>
                    <div class="user-role ${user.isAdmin ? 'admin' : 'user'}">
                        ${user.isAdmin ? 'ئەدمین' : 'بەکارهێنەر'}
                    </div>
                `;
                
                userManagementList.appendChild(userItem);
            });
        }

        // بارکردنی ڕێکخستنەکان
        function loadSettings() {
            // تێمەکان
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    
                    const theme = this.dataset.theme;
                    settings.theme = theme;
                    applyTheme(theme);
                    saveUserData();
                    showNotification('تێمەکە گۆڕدرا بۆ ' + theme);
                });
            });
            
            // سویچەکان
            document.getElementById('auto-date').checked = settings.autoDate;
            document.getElementById('monthly-alert').checked = settings.monthlyAlert;
            document.getElementById('auto-old-debts').checked = settings.autoOldDebts;
            document.getElementById('vibration').checked = settings.vibration;
            document.getElementById('sound-notifications').checked = settings.soundNotifications;
            document.getElementById('dark-mode').checked = settings.darkMode;
            document.getElementById('large-fonts').checked = settings.largeFonts;
            
            // سویچەکان ئێڤێنتەکان
            document.getElementById('auto-date').addEventListener('change', function() {
                settings.autoDate = this.checked;
                saveUserData();
                updateAutoDateFields();
            });
            
            document.getElementById('monthly-alert').addEventListener('change', function() {
                settings.monthlyAlert = this.checked;
                saveUserData();
            });
            
            document.getElementById('auto-old-debts').addEventListener('change', function() {
                settings.autoOldDebts = this.checked;
                saveUserData();
            });
            
            document.getElementById('vibration').addEventListener('change', function() {
                settings.vibration = this.checked;
                saveUserData();
                if (this.checked && 'vibrate' in navigator) {
                    navigator.vibrate(50);
                }
            });
            
            document.getElementById('sound-notifications').addEventListener('change', function() {
                settings.soundNotifications = this.checked;
                saveUserData();
            });
            
            document.getElementById('dark-mode').addEventListener('change', function() {
                settings.darkMode = this.checked;
                if (this.checked) {
                    document.body.classList.add('theme-dark');
                } else {
                    document.body.classList.remove('theme-dark');
                }
                saveUserData();
            });
            
            document.getElementById('large-fonts').addEventListener('change', function() {
                settings.largeFonts = this.checked;
                if (this.checked) {
                    document.body.style.fontSize = '16px';
                } else {
                    document.body.style.fontSize = '15px';
                }
                saveUserData();
            });
            
            // تازەکردنەوەی لیستی خێرا
            document.getElementById('refresh-quick-list').addEventListener('click', function() {
                loadQuickDebtList();
                showNotification('لیستی قەرزی خێرا نوێکرایەوە');
            });
        }

        // جێبەجێکردنی ڕێکخستنەکان
        function applySettings() {
            applyTheme(settings.theme);
            
            if (settings.darkMode) {
                document.body.classList.add('theme-dark');
            }
            
            if (settings.largeFonts) {
                document.body.style.fontSize = '16px';
            }
            
            // چالاککردنی تێمەکان
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.theme === settings.theme) {
                    option.classList.add('active');
                }
            });
            
            // نوێکردنەوەی خانەکانی بەروار
            updateAutoDateFields();
        }

        // جێبەجێکردنی تێم
        function applyTheme(theme) {
            document.body.className = '';
            document.body.classList.add('theme-' + theme);
        }

        // ڕێکخستنی ڕاپۆرت
        function setupReport() {
            document.getElementById('prev-month').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 1) {
                    currentMonth = 12;
                    currentYear--;
                }
                loadReport();
            });
            
            document.getElementById('next-month').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 12) {
                    currentMonth = 1;
                    currentYear++;
                }
                loadReport();
            });
            
            document.getElementById('export-data').addEventListener('click', function() {
                const data = {
                    people: people,
                    debts: debts,
                    payments: payments,
                    messages: messages,
                    users: users,
                    settings: settings,
                    exportedAt: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `debt-data-${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showNotification('زانیارییەکان بە سەرکەوتوویی هەناردەکران!');
            });
            
            document.getElementById('import-data').addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.addEventListener('change', function() {
                    const file = this.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (data.people && data.debts) {
                                if (confirm('ئەمە هەموو زانیارییەکانی ئێستا لەبەر دەگرێت. بەردەوامبیت؟')) {
                                    people = data.people;
                                    debts = data.debts;
                                    payments = data.payments || [];
                                    messages = data.messages || [];
                                    users = data.users || [];
                                    if (data.settings) settings = data.settings;
                                    saveUserData();
                                    
                                    loadPeopleList();
                                    loadQuickDebtList();
                                    loadReport();
                                    loadContacts();
                                    loadUserManagement();
                                    updateNotificationCount();
                                    applySettings();
                                    
                                    showNotification('زانیارییەکان بە سەرکەوتوویی هێنرانەوە!');
                                }
                            } else {
                                showNotification('فۆرماتی فایلی زانیارییەکان دروست نیە!', 'error');
                            }
                        } catch (err) {
                            showNotification('هەڵە لە خوێندنەوەی فایلەکە: ' + err.message, 'error');
                        }
                    };
                    
                    reader.readAsText(file);
                });
                
                input.click();
            });
            
            document.getElementById('backup-data').addEventListener('click', function() {
                const backup = {
                    people: people,
                    debts: debts,
                    payments: payments,
                    messages: messages,
                    users: users,
                    settings: settings,
                    backedUpAt: new Date().toISOString()
                };
                
                localStorage.setItem('debtBackup', JSON.stringify(backup));
                localStorage.setItem('lastBackup', new Date().toISOString());
                
                updateSystemInfo();
                showNotification('پاشەکەوت بە سەرکەوتوویی دروستکرا!');
            });
            
            document.getElementById('reset-data').addEventListener('click', function() {
                if (confirm('دڵنیای لە سڕینەوەی هەموو زانیارییەکان؟ ئەم کارە گەڕانەوەی نیە!')) {
                    localStorage.clear();
                    people = [];
                    debts = [];
                    payments = [];
                    messages = [];
                    users = [];
                    currentUser = null;
                    settings = {
                        autoDate: true,
                        monthlyAlert: true,
                        autoOldDebts: true,
                        vibration: true,
                        soundNotifications: false,
                        theme: 'blue',
                        darkMode: false,
                        largeFonts: false
                    };
                    
                    createAdminUsers();
                    createSampleMessages();
                    saveUserData();
                    applySettings();
                    showAuthPage();
                    
                    showNotification('هەموو زانیارییەکان سڕانەوە!');
                }
            });
        }

        // بارکردنی ڕاپۆرت
        function loadReport() {
            const monthNames = ["کانوونی دووەم", "شوبات", "ئازار", "نیسان", "ئایار", "حوزەیران", 
                              "تەمموز", "ئاب", "ئەیلول", "تشرینی یەکەم", "تشرینی دووەم", "کانوونی یەکەم"];
            document.getElementById('report-month').textContent = `${monthNames[currentMonth-1]} ${currentYear}`;
            
            // گەڕان بۆ قەرزەکانی ئەم مانگە
            const monthDebts = debts.filter(debt => {
                const debtDate = new Date(debt.date);
                return debtDate.getMonth() + 1 === currentMonth && debtDate.getFullYear() === currentYear;
            });
            
            // گەڕان بۆ پارەدانەکانی ئەم مانگە
            const monthPayments = payments.filter(payment => {
                const paymentDate = new Date(payment.date);
                return paymentDate.getMonth() + 1 === currentMonth && paymentDate.getFullYear() === currentYear;
            });
            
            const totalOriginal = monthDebts.reduce((sum, debt) => sum + (debt.originalAmount || debt.amount || 0), 0);
            const totalPaid = monthPayments.reduce((sum, payment) => sum + payment.amount, 0);
            const totalRemaining = totalOriginal - totalPaid;
            
            document.getElementById('total-debts').textContent = formatCurrency(totalOriginal);
            document.getElementById('total-people').textContent = people.length;
            document.getElementById('paid-debts').textContent = formatCurrency(totalPaid);
            document.getElementById('unpaid-debts').textContent = formatCurrency(totalRemaining);
            
            const collectionRate = totalOriginal > 0 ? Math.round((totalPaid / totalOriginal) * 100) : 0;
            document.getElementById('collection-rate').textContent = collectionRate + '%';
            document.getElementById('collection-progress').style.width = collectionRate + '%';
            
            const distribution = document.getElementById('debt-distribution');
            distribution.innerHTML = '';
            
            if (monthDebts.length === 0) {
                distribution.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-pie"></i>
                        <h3>هیچ زانیارییەک نیە</h3>
                        <p>هیچ قەرزێک نیە بۆ ئەم مانگە</p>
                    </div>
                `;
                return;
            }
            
            const debtByPerson = {};
            monthDebts.forEach(debt => {
                let personName;
                
                if (debt.status === 'quick') {
                    personName = debt.personName || 'قەرزی خێرا';
                } else {
                    const person = people.find(p => p.id === debt.personId);
                    personName = person ? person.name : 'نەناسراو';
                }
                
                if (!debtByPerson[personName]) {
                    debtByPerson[personName] = 0;
                }
                
                debtByPerson[personName] += (debt.originalAmount || debt.amount || 0);
            });
            
            let distributionHTML = '<div style="padding: 15px;">';
            
            Object.keys(debtByPerson).forEach(personName => {
                const amount = debtByPerson[personName];
                const percentage = Math.round((amount / totalOriginal) * 100);
                
                distributionHTML += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${personName}</span>
                            <span>${formatCurrency(amount)} (${percentage}%)</span>
                        </div>
                        <div style="height: 8px; background-color: rgba(0,0,0,0.05); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: ${percentage}%; background-color: var(--primary-color);"></div>
                        </div>
                    </div>
                `;
            });
            
            distributionHTML += '</div>';
            distribution.innerHTML = distributionHTML;
        }

        // ڕێکخستنی بۆتۆم نێڤ
        function setupBottomNav() {
            document.querySelectorAll('.nav-item').forEach(navItem => {
                navItem.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const pageId = this.dataset.page;
                    
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.querySelectorAll('.page').forEach(page => {
                        page.classList.remove('active');
                        if (page.id === pageId) {
                            page.classList.add('active');
                        }
                    });
                    
                    document.querySelectorAll('.tab').forEach(tab => {
                        tab.classList.remove('active');
                        if (tab.dataset.page === pageId) {
                            tab.classList.add('active');
                        }
                    });
                    
                    if (pageId === 'report') {
                        loadReport();
                    }
                    
                    if (pageId === 'chat') {
                        loadContacts();
                    }
                    
                    if (settings.vibration && 'vibrate' in navigator) {
                        navigator.vibrate(30);
                    }
                });
            });
        }

        // چێککردن بۆ قەرزە کۆنەکان
        function checkForOverdueDebts() {
            if (!settings.autoOldDebts) return;
            
            const now = new Date();
            const oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
            
            let updated = false;
            
            debts.forEach(debt => {
                const debtDate = new Date(debt.date);
                if (debtDate < oneMonthAgo && debt.status === 'active') {
                    debt.status = 'overdue';
                    updated = true;
                }
            });
            
            if (updated) {
                saveUserData();
                
                if (settings.monthlyAlert) {
                    showNotification('هەندێک قەرز وەک کۆن نیشاندران!', 'warning');
                }
            }
        }

        // پاککردنەوەی زانیاریەکان
        function resetData() {
            console.log('پاککردنەوەی زانیاریەکان...');
            localStorage.clear();
            people = [];
            debts = [];
            payments = [];
            messages = [];
            users = [];
            currentUser = null;
            settings = {
                autoDate: true,
                monthlyAlert: true,
                autoOldDebts: true,
                vibration: true,
                soundNotifications: false,
                theme: 'blue',
                darkMode: false,
                largeFonts: false
            };
            
            createAdminUsers();
            createSampleMessages();
            saveUserData();
            applySettings();
            showAuthPage();
        }

        // نیشاندانی نۆتیفیکەیشن
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            if (type === 'error') {
                notification.style.backgroundColor = 'var(--danger-color)';
            } else if (type === 'warning') {
                notification.style.backgroundColor = 'var(--warning-color)';
                notification.style.color = '#333';
            } else {
                notification.style.backgroundColor = 'var(--success-color)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
            
            if (settings.soundNotifications) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = type === 'error' ? 300 : 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    console.log('دەنگ پشتگیری ناکرێت');
                }
            }
        }

        // نوێکردنەوەی زانیاری سیستەم
        function updateSystemInfo() {
            document.getElementById('sys-total-people').textContent = people.length;
            document.getElementById('sys-total-debts').textContent = debts.length;
            
            const dataSize = JSON.stringify(people).length + JSON.stringify(debts).length + 
                            JSON.stringify(payments).length + JSON.stringify(messages).length + 
                            JSON.stringify(users).length + JSON.stringify(settings).length;
            document.getElementById('sys-data-size').textContent = Math.round(dataSize / 1024) + ' KB';
            
            const lastBackup = localStorage.getItem('lastBackup');
            if (lastBackup) {
                const backupDate = new Date(lastBackup);
                document.getElementById('sys-last-backup').textContent = backupDate.toLocaleDateString('fa-IR');
            } else {
                document.getElementById('sys-last-backup').textContent = 'هەرگیز';
            }
        }

        // چێکی خۆکار بۆ قەرزە کۆنەکان
        setInterval(checkForOverdueDebts, 24 * 60 * 60 * 1000);
        
        // داواکردنی مۆڵەتی Notification لە بەکارهێنەر
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        // چێککردن بۆ پشتگیری ڤایبرەیشن
        if ('vibrate' in navigator) {
            console.log('ڤایبرەیشن پشتگیری دەکرێت');
        }
    </script>
</body>
</html>
